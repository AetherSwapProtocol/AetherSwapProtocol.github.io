<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AetherSwap | Next-Gen DEX Aggregator</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
  <script src="https://unpkg.com/@solana/web3.js@1.70.1/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://s3.tradingview.com/tv.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #7e22ce 0%, #3b82f6 100%);
    }
    .tradingview-widget-container iframe {
      border-radius: 12px !important;
    }
    .language-selector {
      transition: all 0.3s ease;
    }
    .language-selector:hover {
      transform: translateY(-2px);
    }
    .home-button {
      transition: transform 0.2s;
    }
    .home-button:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  <!-- Navbar -->
  <nav class="gradient-bg px-6 py-3 shadow-xl sticky top-0 z-50">
    <div class="container mx-auto flex justify-between items-center">
      <div class="flex items-center space-x-4">
        <a href="#" class="home-button flex items-center">
          <i class="fas fa-home mr-2"></i>
          <span class="text-2xl font-bold text-white">AetherSwap</span>
        </a>
        <div class="hidden md:flex space-x-6">
          <a href="#swap" class="nav-link hover:text-purple-300 transition">Swap</a>
          <a href="#liquidity" class="nav-link hover:text-purple-300 transition">Liquidity</a>
          <a href="#farm" class="nav-link hover:text-purple-300 transition">Farm (APR: 325%)</a>
          <a href="#launchpad" class="nav-link hover:text-purple-300 transition">Launchpad</a>
        </div>
      </div>
      <div class="flex items-center space-x-4">
        <button id="connectWalletBtn" class="connect-wallet-btn bg-purple-700 hover:bg-purple-600 px-4 py-2 rounded-lg transition">
          <i class="fas fa-wallet mr-2"></i>
          <span id="walletText">Connect Wallet</span>
        </button>
        <select id="languageSelector" class="language-selector bg-gray-800 text-sm rounded-full px-3 py-1 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
          <option value="en">ðŸ‡¬ðŸ‡§ English</option>
          <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
          <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
          <option value="zh">ðŸ‡¨ðŸ‡³ ä¸­æ–‡</option>
        </select>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Swap Card -->
    <div class="lg:col-span-2 space-y-6">
      <div id="swap" class="bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-700">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold" data-translate="swap_title">Multi-DEX Aggregator</h2>
          <div class="flex space-x-2">
            <button class="px-3 py-1 bg-gray-700 rounded-lg text-sm hover:bg-gray-600 transition" data-translate="slippage_btn">0.5% Slippage</button>
            <button class="px-3 py-1 bg-gray-700 rounded-lg text-sm hover:bg-gray-600 transition" data-translate="auto_router">Auto Router</button>
          </div>
        </div>

        <!-- From Token -->
        <div class="bg-gray-750 rounded-xl p-4 mb-3">
          <div class="flex justify-between mb-2">
            <label class="text-gray-400" data-translate="from_label">From</label>
            <div class="text-sm text-gray-400">
              <span id="fromBalanceText" data-translate="balance">Balance: 0.0</span>
              <button class="ml-2 text-purple-400 hover:text-purple-300 transition" data-translate="max_btn">Max</button>
            </div>
          </div>
          <div class="flex items-center">
            <input 
              type="number" 
              id="fromAmount" 
              placeholder="0.0" 
              class="bg-transparent text-2xl w-full focus:outline-none"
            >
            <div class="flex items-center bg-gray-700 rounded-lg px-3 py-2 hover:bg-gray-600 transition">
              <img id="fromTokenImg" src="https://cryptologos.cc/logos/solana-sol-logo.png" class="w-6 h-6 mr-2">
              <select id="fromTokenSelect" class="bg-transparent focus:outline-none">
                <option value="SOL">SOL</option>
                <option value="USDC">USDC</option>
                <option value="BONK">BONK</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Switch Button -->
        <div class="flex justify-center my-2">
          <button id="switchTokensBtn" class="bg-gray-700 p-2 rounded-full hover:bg-gray-600 transition">
            <i class="fas fa-arrow-down text-purple-400"></i>
          </button>
        </div>

        <!-- To Token -->
        <div class="bg-gray-750 rounded-xl p-4 mb-4">
          <div class="flex justify-between mb-2">
            <label class="text-gray-400" data-translate="to_label">To</label>
            <div class="text-sm text-gray-400">
              <span id="toBalanceText" data-translate="balance">Balance: 0.0</span>
            </div>
          </div>
          <div class="flex items-center">
            <input 
              type="number" 
              id="toAmount" 
              placeholder="0.0" 
              class="bg-transparent text-2xl w-full focus:outline-none" 
              disabled
            >
            <div class="flex items-center bg-gray-700 rounded-lg px-3 py-2 hover:bg-gray-600 transition">
              <img id="toTokenImg" src="https://cryptologos.cc/logos/usd-coin-usdc-logo.png" class="w-6 h-6 mr-2">
              <select id="toTokenSelect" class="bg-transparent focus:outline-none">
                <option value="USDC">USDC</option>
                <option value="SOL">SOL</option>
                <option value="BONK">BONK</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Price Info -->
        <div id="priceInfo" class="bg-gray-750 rounded-lg p-3 mb-4 text-center text-sm">
          <div class="animate-pulse" data-translate="fetching_price">Fetching best price across 5 DEXs...</div>
        </div>

        <!-- Swap Button -->
        <button id="swapBtn" class="w-full gradient-bg py-3 rounded-xl font-bold text-white hover:opacity-90 transition disabled:opacity-50" data-translate="swap_btn">
          Swap Now
        </button>
      </div>

      <!-- Advanced Chart -->
      <div class="bg-gray-800 rounded-2xl p-4 shadow-lg border border-gray-700">
        <div class="h-96" id="tradingview-chart"></div>
      </div>
    </div>

    <!-- Right Sidebar -->
    <div class="space-y-6">
      <!-- Best Routes -->
      <div class="bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-700">
        <h3 class="font-bold mb-4" data-translate="optimal_routes">Optimal Routes</h3>
        <div id="routesContainer" class="space-y-3">
          <div class="route-card bg-gray-750 p-3 rounded-lg hover:bg-gray-700 transition">
            <div class="flex justify-between">
              <span>Jupiter</span>
              <span class="text-green-400" data-translate="best_price">Best Price</span>
            </div>
            <div class="text-sm text-gray-400">SOL â†’ USDC</div>
            <div class="flex justify-between mt-1">
              <span>1 SOL = 24.56 USDC</span>
              <span>0.15% fee</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Portfolio Summary -->
      <div class="bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-700">
        <h3 class="font-bold mb-4" data-translate="your_portfolio">Your Portfolio</h3>
        <div class="space-y-4">
          <div class="flex justify-between">
            <span data-translate="total_value">Total Value</span>
            <span class="font-mono">$1,245.32</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-400" data-translate="24h_change">24h Change</span>
            <span class="text-green-400">+3.2%</span>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Language Translations -->
  <script>
    // Enhanced translations with all UI elements
    const translations = {
      en: {
        swap_title: "Multi-DEX Aggregator",
        slippage_btn: "0.5% Slippage",
        auto_router: "Auto Router",
        from_label: "From",
        to_label: "To",
        balance: "Balance",
        max_btn: "Max",
        swap_btn: "Swap Now",
        fetching_price: "Fetching best price across 5 DEXs...",
        optimal_routes: "Optimal Routes",
        best_price: "Best Price",
        your_portfolio: "Your Portfolio",
        total_value: "Total Value",
        "24h_change": "24h Change",
        connectWallet: "Connect Wallet"
      },
      fr: {
        swap_title: "AgrÃ©gateur Multi-DEX",
        slippage_btn: "0.5% Slippage",
        auto_router: "Routeur Auto",
        from_label: "De",
        to_label: "Ã€",
        balance: "Solde",
        max_btn: "Max",
        swap_btn: "Ã‰changer Maintenant",
        fetching_price: "Recherche du meilleur prix sur 5 DEX...",
        optimal_routes: "Meilleures Routes",
        best_price: "Meilleur Prix",
        your_portfolio: "Votre Portefeuille",
        total_value: "Valeur Totale",
        "24h_change": "Changement 24h",
        connectWallet: "Connecter Portefeuille"
      },
      es: {
        swap_title: "Agregador Multi-DEX",
        slippage_btn: "0.5% Deslizamiento",
        auto_router: "Enrutador Auto",
        from_label: "De",
        to_label: "A",
        balance: "Saldo",
        max_btn: "MÃ¡x",
        swap_btn: "Intercambiar Ahora",
        fetching_price: "Buscando mejor precio en 5 DEXs...",
        optimal_routes: "Rutas Ã“ptimas",
        best_price: "Mejor Precio",
        your_portfolio: "Tu Portafolio",
        total_value: "Valor Total",
        "24h_change": "Cambio 24h",
        connectWallet: "Conectar Billetera"
      },
      zh: {
        swap_title: "å¤šDEXèšåˆå™¨",
        slippage_btn: "0.5% æ»‘ç‚¹",
        auto_router: "è‡ªåŠ¨è·¯ç”±",
        from_label: "ä»Ž",
        to_label: "åˆ°",
        balance: "ä½™é¢",
        max_btn: "æœ€å¤§",
        swap_btn: "ç«‹å³äº¤æ¢",
        fetching_price: "æ­£åœ¨5ä¸ªDEXä¸­å¯»æ‰¾æœ€ä½³ä»·æ ¼...",
        optimal_routes: "æœ€ä¼˜è·¯çº¿",
        best_price: "æœ€ä½³ä»·æ ¼",
        your_portfolio: "æ‚¨çš„æŠ•èµ„ç»„åˆ",
        total_value: "æ€»ä»·å€¼",
        "24h_change": "24å°æ—¶å˜åŒ–",
        connectWallet: "è¿žæŽ¥é’±åŒ…"
      }
    };

    // Initialize with browser language or default to English
    let currentLang = navigator.language.split('-')[0] in translations ? 
                     navigator.language.split('-')[0] : 'en';
    
    document.getElementById('languageSelector').value = currentLang;
    updateLanguage(currentLang);

    // Language switcher functionality
    document.getElementById('languageSelector').addEventListener('change', function() {
      currentLang = this.value;
      updateLanguage(currentLang);
    });

    function updateLanguage(lang) {
      const t = translations[lang];
      // Update all elements with data-translate attribute
      document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.getAttribute('data-translate');
        if (t[key]) {
          el.textContent = t[key];
        }
      });
      // Special cases
      document.getElementById('walletText').textContent = t.connectWallet;
    }

    // Home button functionality
    document.querySelector('.home-button').addEventListener('click', function(e) {
      e.preventDefault();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>

  <!-- TradingView Chart Integration -->
  <script>
    new TradingView.widget({
      autosize: true,
      symbol: "BINANCE:BTCUSDT",
      interval: "15",
      timezone: "Etc/UTC",
      theme: "dark",
      style: "1",
      locale: currentLang,
      toolbar_bg: "#0a0a0a",
      enable_publishing: false,
      hide_side_toolbar: false,
      container_id: "tradingview-chart"
    });
  </script>

  <!-- Enhanced DEX Logic with Error Handling -->
  <script>
    // Configuration with fallback DEXs
    const DEX_APIS = {
      jupiter: "https://quote-api.jup.ag/v6",
      orca: "https://api.orca.so",
      raydium: "https://api.raydium.io",
      backup1: "https://jupiter-backup1.com/v6",
      backup2: "https://jupiter-backup2.com/v6"
    };

    // Token data with auto-refresh capability
    let TOKENS = {
      SOL: {
        mint: "So11111111111111111111111111111111111111112",
        decimals: 9,
        logo: "https://cryptologos.cc/logos/solana-sol-logo.png"
      },
      USDC: {
        mint: "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
        decimals: 6,
        logo: "https://cryptologos.cc/logos/usd-coin-usdc-logo.png"
      },
      BONK: {
        mint: "DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263",
        decimals: 5,
        logo: "https://arweave.net/hQiPZOsRZXGXBJd_82PhVdlM_hACsT_q6wqwf5cSY7I"
      }
    };

    // Cache system for quotes
    const quoteCache = new Map();
    const CACHE_DURATION = 10000; // 10 seconds

    // Wallet connection with improved error handling
    async function connectWallet() {
      const connectBtn = document.getElementById('connectWalletBtn');
      try {
        connectBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Connecting...';
        
        if (!window.solana) {
          throw new Error(translations[currentLang].phantom_not_found || 
                         "Phantom Wallet not detected. Please install it first.");
        }

        const response = await window.solana.connect();
        const publicKey = response.publicKey.toString();
        
        document.getElementById('walletText').textContent = 
          publicKey.slice(0, 4) + '...' + publicKey.slice(-4);
        
        await checkBalances();
        showNotification(translations[currentLang].wallet_connected || "Wallet connected successfully", "success");
        
      } catch (err) {
        console.error("Wallet connection error:", err);
        showNotification(err.message, "error");
      } finally {
        connectBtn.innerHTML = `<i class="fas fa-wallet mr-2"></i>${document.getElementById('walletText').textContent}`;
      }
    }

    document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);

    // Token switching with balance update
    document.getElementById('fromTokenSelect').addEventListener('change', function() {
      const token = this.value;
      document.getElementById('fromTokenImg').src = TOKENS[token].logo;
      updateBalances();
    });

    document.getElementById('toTokenSelect').addEventListener('change', function() {
      const token = this.value;
      document.getElementById('toTokenImg').src = TOKENS[token].logo;
      updateBalances();
    });

    // Switch tokens button
    document.getElementById('switchTokensBtn').addEventListener('click', function() {
      const fromSelect = document.getElementById('fromTokenSelect');
      const toSelect = document.getElementById('toTokenSelect');
      const fromAmount = document.getElementById('fromAmount');
      const toAmount = document.getElementById('toAmount');
      
      // Swap selected tokens
      const temp = fromSelect.value;
      fromSelect.value = toSelect.value;
      toSelect.value = temp;
      
      // Update logos
      document.getElementById('fromTokenImg').src = TOKENS[fromSelect.value].logo;
      document.getElementById('toTokenImg').src = TOKENS[toSelect.value].logo;
      
      // Swap amounts if available
      if (toAmount.value) {
        fromAmount.value = toAmount.value;
        fetchQuote();
      }
      
      updateBalances();
    });

    // Debounced quote fetching
    let debounceTimer;
    document.getElementById('fromAmount').addEventListener('input', function() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        const amount = parseFloat(this.value);
        if (amount > 0) fetchQuote();
      }, 500);
    });

    // Enhanced quote fetching with cache and fallback
    async function fetchQuote() {
      const fromToken = document.getElementById('fromTokenSelect').value;
      const toToken = document.getElementById('toTokenSelect').value;
      const amount = parseFloat(document.getElementById('fromAmount').value);
      
      if (!amount || amount <= 0) return;
      
      const priceInfo = document.getElementById('priceInfo');
      priceInfo.innerHTML = `<div class="animate-pulse">${translations[currentLang].fetching_price}</div>`;
      
      try {
        const cacheKey = `${fromToken}-${toToken}-${amount}`;
        const cachedQuote = quoteCache.get(cacheKey);
        
        if (cachedQuote && (Date.now() - cachedQuote.timestamp < CACHE_DURATION)) {
          updatePriceInfo(cachedQuote.data);
          return;
        }
        
        const quote = await getBestQuote(fromToken, toToken, amount);
        quoteCache.set(cacheKey, {
          data: quote,
          timestamp: Date.now()
        });
        
        updatePriceInfo(quote);
      } catch (error) {
        console.error("Quote error:", error);
        priceInfo.innerHTML = `<div class="text-red-400">${translations[currentLang].quote_error || "Error fetching price"}</div>`;
      }
    }

    // Notification system
    function showNotification(message, type) {
      const notif = document.createElement('div');
      notif.className = `fixed top-20 right-4 p-3 rounded-lg shadow-lg z-50 ${
        type === 'success' ? 'bg-green-600' : 'bg-red-600'
      }`;
      notif.textContent = message;
      document.body.appendChild(notif);
      setTimeout(() => {
        notif.style.opacity = '0';
        setTimeout(() => notif.remove(), 300);
      }, 3000);
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', function() {
      updateBalances();
      
      // Set default token images
      document.getElementById('fromTokenImg').src = TOKENS.SOL.logo;
      document.getElementById('toTokenImg').src = TOKENS.USDC.logo;
    });
  </script>
</body>
</html>