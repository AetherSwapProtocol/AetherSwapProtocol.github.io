<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AetherSwap ‚Äì Dashboard = Swap</title>
<style>
  /* Reset & Variables */
  :root { --primary:#1e90ff; --dark:#0a0a0a; --gray:#1e1e1e; --light:#fff; --error:#ff4c4c; --success:#14f195; }
  *{margin:0;padding:0;box-sizing:border-box;font-family:Inter,sans-serif;}
  body{background:var(--dark);color:var(--light);padding-bottom:120px;}
  button, .nav-item{cursor:pointer;}
  .hidden{display:none;}
  header, .bottom-nav{background:var(--gray);display:flex;align-items:center;padding:12px;}
  header{justify-content:space-between;}
  header h1{font-size:20px;}
  header button{background:var(--primary);border:none;color:#fff;padding:6px 12px;border-radius:6px;}
  #main{padding:16px;max-width:500px;margin:0 auto;}
  .section{background:var(--gray);border-radius:12px;padding:16px;margin-bottom:16px;}
  .section h2{margin-bottom:12px;color:var(--primary);}
  .token-selector{position:relative;background:rgba(255,255,255,0.1);border-radius:8px;padding:12px;margin-bottom:12px;}
  .token-selector input{width:100%;background:transparent;border:none;color:var(--light);font-size:20px;}
  .token-symbol{position:absolute;top:14px;right:14px;font-size:16px;}
  .quote{margin-bottom:8px;font-size:14px;}
  .btn-primary{width:100%;padding:14px;background:var(--primary);border:none;border-radius:8px;font-size:16px;color:#fff;}
  #pair-info{background:var(--gray);border-radius:8px;padding:12px;text-align:center;margin-top:12px;}
  #pair-info h3{margin-bottom:6px;}
  #pair-info .price{font-size:24px;}
  #pair-info .change{margin-left:8px;}
  #pair-info canvas{width:100%;height:60px;margin-top:8px;}
  .modal{position:fixed;top:0;bottom:0;left:0;right:0;background:rgba(0,0,0,0.8);display:none;justify-content:center;align-items:center;z-index:100;}
  .modal-content{background:var(--gray);padding:16px;border-radius:12px;width:90%;max-width:400px;}
  .modal-content h3{margin-bottom:12px;}
  .modal-content input{width:100%;padding:10px;margin-bottom:12px;background:#222;border:none;border-radius:8px;color:#fff;}
  .token-item{display:flex;justify-content:space-between;padding:8px;background:#222;border-radius:8px;margin-bottom:6px;cursor:pointer;}
  footer{padding:16px;font-size:12px;color:#aaa;text-align:center;}
  .bottom-nav{position:fixed;bottom:0;left:0;right:0;justify-content:space-around;}
  .nav-item{font-size:12px;color:#aaa;text-align:center;flex:1;}
  .nav-item.active{color:var(--primary);}
</style>
</head>
<body>

<header>
  <h1>AetherSwap</h1>
  <button id="btn-connect">Connect Wallet</button>
</header>

<div id="main">
  <!-- Dashboard = Swap -->
  <section id="swap" class="section">
    <h2>Dashboard / Swap</h2>
    <!-- Token A -->
    <div class="token-selector">
      <input id="amt-in" type="number" placeholder="0.0" />
      <span class="token-symbol" id="sym-in">Select</span>
      <button onclick="openModal('in')">Select Token</button>
    </div>
    <!-- Token B -->
    <div class="token-selector">
      <input id="amt-out" type="number" placeholder="0.0" disabled />
      <span class="token-symbol" id="sym-out">Select</span>
      <button onclick="openModal('out')">Select Token</button>
    </div>
    <!-- Quote info -->
    <div class="quote" id="quote-text">‚Äî</div>
    <!-- Swap button -->
    <button id="btn-swap" class="btn-primary" disabled>Swap</button>
    <!-- Pair info module -->
    <div id="pair-info" class="hidden">
      <h3 id="pname">PAIR</h3>
      <div><span id="pprice" class="price">0</span> <span id="pchange" class="change">(¬±0%)</span></div>
      <canvas id="pchart"></canvas>
      <button onclick="openChart()">Show chart</button>
    </div>
  </section>

  <!-- Placeholder sections -->
  <section id="portfolio" class="section hidden"><h2>Portfolio</h2><p>Coming soon‚Ä¶</p></section>
  <section id="settings" class="section hidden"><h2>Settings</h2><p>Slippage, etc.</p></section>
  <section id="legal" class="section hidden">
    <h2>Legal</h2>
    <p><strong>Disclaimer:</strong> AetherSwap is a non‚Äëcustodial interface leveraging Jupiter Aggregator on Solana.</p>
    <p><strong>Risk:</strong> Crypto involves risk. Always do your own research (DYOR).</p>
    <p><strong>Platform Fee:</strong> A 0.15% platform fee is automatically applied to swaps and directed to <code>H3z4XmmpLwjm2MhfRuEFhK4DjGHhkbQvmgSUUCTrm6hw</code>.</p>
    <p><strong>Data & Routing:</strong> Quotes and routes powered by Jupiter Aggregator.</p>
    <p><strong>Contact:</strong> <a href="mailto:contact@aetherswap.xyz" style="color:var(--primary);">contact@aetherswap.xyz</a></p>
    <p><strong>Version:</strong> 1.0.0</p>
  </section>
</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <div class="nav-item active">üí± Swap</div>
  <div class="nav-item">üìä Portfolio</div>
  <div class="nav-item">‚öôÔ∏è Settings</div>
  <div class="nav-item">üìú Legal</div>
</div>

<!-- Token Modal -->
<div id="modal-tk" class="modal">
  <div class="modal-content">
    <h3>Select Token</h3>
    <input id="tk-search" placeholder="Search or paste mint" />
    <div id="tk-list"></div>
    <button class="btn-primary" onclick="closeModal()">Close</button>
  </div>
</div>

<!-- Chart Modal -->
<div id="modal-chart" class="modal">
  <div class="modal-content">
    <h3>Price Chart</h3>
    <canvas id="chart-lg" style="width:100%;height:200px;"></canvas>
    <button class="btn-primary" onclick="closeChart()">Close</button>
  </div>
</div>

<footer>
  ¬©2025 AetherSwap. Data via Jupiter Aggregator. Powered by Solana. | <a href="https://solscan.io" target="_blank">Solscan</a>
</footer>

<script>
let state = { tokens:[], in:null, out:null, wallet:null, provider:null, slippageBps:50, route:null };

document.getElementById('btn-connect').onclick = async () => {
  if(window.solana?.isPhantom){
    let resp = await solana.connect();
    state.wallet = resp.publicKey.toString();
    state.provider = solana;
    document.getElementById('btn-connect').innerText = state.wallet.slice(0,4)+'‚Ä¶'+state.wallet.slice(-4);
    updateSwap();
  } else alert('Install Phantom wallet');
};

async function loadTokens(){
  let resp = await fetch('https://quote-api.jup.ag/v6/tokens');
  let j = await resp.json();
  state.tokens = j.data;
}
loadTokens();

let currentDir='';
function openModal(dir){
  currentDir=dir;
  document.getElementById('modal-tk').style.display='flex';
  renderTokenList();
}
function closeModal(){document.getElementById('modal-tk').style.display='none';}

document.getElementById('tk-search').oninput = renderTokenList;
function renderTokenList(){
  let q = document.getElementById('tk-search').value.trim().toLowerCase();
  let filtered = state.tokens.filter(t =>
    t.symbol.toLowerCase().includes(q) ||
    t.name.toLowerCase().includes(q) ||
    t.address.toLowerCase()===q
  );
  document.getElementById('tk-list').innerHTML = filtered.slice(0,50).map(t =>
    `<div class="token-item" onclick="selectToken('${t.address}')">
      <span>${t.symbol}</span><span>${t.address.slice(0,6)}‚Ä¶</span>
    </div>`
  ).join('');
}
function selectToken(addr){
  let tok = state.tokens.find(t=>t.address===addr);
  if(currentDir==='in'){ state.in=tok; document.getElementById('sym-in').innerText=tok.symbol; }
  else { state.out=tok; document.getElementById('sym-out').innerText=tok.symbol; }
  closeModal(); updateSwap();
}

document.getElementById('amt-in').oninput = updateSwap;
async function updateSwap(){
  let ai = parseFloat(document.getElementById('amt-in').value);
  if(!state.in || !state.out || !ai || !state.wallet){
    document.getElementById('btn-swap').disabled = true;
    document.getElementById('quote-text').innerText='‚Äî';
    return;
  }
  const amt = Math.round(ai * 10**state.in.decimals);
  const url = `https://quote-api.jup.ag/v6/quote?inputMint=${state.in.address}&outputMint=${state.out.address}&amount=${amt}&slippageBps=${state.slippageBps}&feeBps=15`;
  let res = await fetch(url).then(r=>r.json());
  if(!res.data || res.data.length===0) return;
  let rt = res.data[0];
  document.getElementById('amt-out').value = (rt.outAmount/10**state.out.decimals).toFixed(6);
  document.getElementById('quote-text').innerText = `Route: ${rt.route.map(r=>r.marketName).join('‚Üí')} | Min received: ${(rt.outAmountWithSlippage/10**state.out.decimals).toFixed(6)}`;
  document.getElementById('btn-swap').disabled=false;
  state.route=rt;
  renderPair(rt);
}

function renderPair(rt){
  let a=state.in,b=state.out;
  document.getElementById('pname').innerText=`${a.symbol} / ${b.symbol}`;
  let price=rt.outAmount/rt.inAmount;
  document.getElementById('pprice').innerText=price.toFixed(6);
  let diff=(Math.random()*2-1).toFixed(2);
  document.getElementById('pchange').innerText=`(${diff>0?'+':''}${diff}%)`;
  document.getElementById('pair-info').classList.remove('hidden');
  const ctx = document.getElementById('pchart').getContext('2d');
  new Chart(ctx,{type:'line',data:{labels:[],datasets:[{data:Array.from({length:20},(_,i)=>price*(1+Math.sin(i/3)*0.01)),borderColor:var(--primary),fill:false,tension:0.3}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{x:{display:false},y:{display:false}}}});
}

document.getElementById('btn-swap').onclick=async()=>{
  let rt=state.route;
  document.getElementById('btn-swap').innerText='Swapping...';
  let body={route:rt,userPublicKey:state.wallet,wrapUnwrapSOL:true,feeBps:15,feeAccount:"H3z4XmmpLwjm2MhfRuEFhK4DjGHhkbQvmgSUUCTrm6hw"};
  let res=await fetch('https://quote-api.jup.ag/v6/swap',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}).then(r=>r.json());
  if(!res.swapTransaction){alert('Swap failed'); document.getElementById('btn-swap').innerText='Swap';return;}
  const tx = Uint8Array.from(atob(res.swapTransaction),c=>c.charCodeAt(0));
  let signed = await state.provider.signTransaction({serialized:tx});
  let resp = await state.provider.sendTransaction({serialized:signed.serialize()},{skipPreflight:true});
  alert('Swap executed! Tx: '+resp);
  document.getElementById('btn-swap').innerText='Swap';
};

function openChart(){document.getElementById('modal-chart').style.display='flex';}
function closeChart(){document.getElementById('modal-chart').style.display='none';}

document.querySelectorAll('.bottom-nav .nav-item').forEach((el,i)=>{
  el.onclick=()=>{
    document.querySelectorAll('.bottom-nav .nav-item').forEach(n=>n.classList.remove('active'));
    el.classList.add('active');
    ['swap','portfolio','settings','legal'].forEach((id,j)=>document.getElementById(id).classList.toggle('hidden',i!==j));
  };
});

const s = document.createElement('script');
s.src='https://cdn.jsdelivr.net/npm/chart.js';
document.head.appendChild(s);
</script>

</body>
</html>