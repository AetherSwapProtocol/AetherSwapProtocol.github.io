<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AetherSwap - DEX RÃ©el</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@solana/web3.js@1.70.1/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@project-serum/anchor@0.27.0/dist/anchor.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap');
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: #0a0a0a;
            color: white;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #7e22ce 0%, #3b82f6 100%);
        }
        .token-list {
            max-height: 60vh;
            scrollbar-width: thin;
            scrollbar-color: #3b82f6 #1e1e1e;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navbar -->
    <nav class="container mx-auto px-6 py-4 flex justify-between items-center border-b border-gray-800">
        <div class="flex items-center space-x-3">
            <div class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center">
                <i class="fas fa-bolt text-white"></i>
            </div>
            <span class="text-2xl font-bold">AetherSwap</span>
        </div>
        <button id="connectWalletBtn" class="px-4 py-2 bg-gray-800 rounded-full hover:bg-gray-700 transition">
            <i class="fas fa-wallet mr-2"></i> Connect Wallet
        </button>
    </nav>

    <!-- Main Swap Interface -->
    <main class="container mx-auto px-4 py-8 max-w-md">
        <div class="bg-gray-900 rounded-2xl p-6 shadow-xl border border-gray-800">
            <!-- Swap Header -->
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-xl font-bold">Swap</h1>
                <div class="flex space-x-2">
                    <button class="p-2 rounded-lg bg-gray-800 hover:bg-gray-700 transition">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>

            <!-- From Token -->
            <div class="bg-gray-800 rounded-xl p-4 mb-4">
                <div class="flex justify-between mb-2">
                    <span class="text-gray-400 text-sm">From</span>
                    <span id="fromBalance" class="text-gray-400 text-sm">Balance: 0.0</span>
                </div>
                <div class="flex items-center">
                    <input id="fromAmount" type="number" placeholder="0.0" 
                           class="bg-transparent text-2xl w-full focus:outline-none">
                    <button id="selectFromToken" class="flex items-center space-x-2 bg-gray-700 px-3 py-2 rounded-lg ml-2 min-w-[120px]">
                        <img id="fromTokenImg" src="https://cryptologos.cc/logos/solana-sol-logo.png" alt="SOL" class="w-6 h-6 rounded-full">
                        <span id="fromTokenSymbol">SOL</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                </div>
            </div>

            <!-- Swap Arrow -->
            <div class="flex justify-center my-2">
                <button id="switchTokens" class="bg-gray-800 p-2 rounded-full hover:bg-gray-700 transition transform hover:rotate-180 duration-300">
                    <i class="fas fa-arrow-down text-purple-500"></i>
                </button>
            </div>

            <!-- To Token -->
            <div class="bg-gray-800 rounded-xl p-4 mb-6">
                <div class="flex justify-between mb-2">
                    <span class="text-gray-400 text-sm">To</span>
                    <span id="toBalance" class="text-gray-400 text-sm">Balance: 0.0</span>
                </div>
                <div class="flex items-center">
                    <input id="toAmount" type="number" placeholder="0.0" 
                           class="bg-transparent text-2xl w-full focus:outline-none">
                    <button id="selectToToken" class="flex items-center space-x-2 bg-gray-700 px-3 py-2 rounded-lg ml-2 min-w-[120px]">
                        <img id="toTokenImg" src="https://cryptologos.cc/logos/usd-coin-usdc-logo.png" alt="USDC" class="w-6 h-6 rounded-full">
                        <span id="toTokenSymbol">USDC</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                </div>
            </div>

            <!-- Price Info -->
            <div class="mb-4 p-3 bg-gray-800 rounded-lg">
                <div class="flex justify-between text-sm">
                    <span class="text-gray-400">Price</span>
                    <span id="priceInfo">1 SOL = 24.50 USDC</span>
                </div>
            </div>

            <!-- Swap Button -->
            <button id="swapBtn" class="w-full gradient-bg py-3 rounded-xl font-bold text-white hover:opacity-90 transition disabled:opacity-50">
                Connect Wallet
            </button>
        </div>
    </main>

    <!-- Token Selection Modal -->
    <div id="tokenModal" class="fixed inset-0 bg-black bg-opacity-70 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-gray-900 rounded-2xl w-full max-w-md max-h-[80vh] flex flex-col">
            <div class="p-4 border-b border-gray-800 flex justify-between items-center">
                <h3 class="text-lg font-bold">Select Token</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <input id="tokenSearch" type="text" placeholder="Search token..." 
                       class="w-full bg-gray-800 rounded-lg px-4 py-2 mb-4 focus:outline-none focus:ring-1 focus:ring-purple-500">
                <div class="token-list overflow-y-auto">
                    <!-- Popular Tokens -->
                    <h4 class="text-gray-400 text-sm mb-2">Popular Tokens</h4>
                    <div id="popularTokens" class="space-y-2 mb-6">
                        <!-- Filled by JavaScript -->
                    </div>
                    
                    <!-- All Tokens -->
                    <h4 class="text-gray-400 text-sm mb-2">All Tokens</h4>
                    <div id="allTokens" class="space-y-2">
                        <!-- Filled by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration Solana
        const SOLANA_RPC = "https://api.mainnet-beta.solana.com";
        const connection = new solanaWeb3.Connection(SOLANA_RPC);
        let wallet;
        let currentSelection = 'from'; // 'from' or 'to'

        // Tokens list (with CoinGecko API IDs)
        const TOKENS = [
            { symbol: "SOL", name: "Solana", logo: "https://cryptologos.cc/logos/solana-sol-logo.png", coingeckoId: "solana" },
            { symbol: "USDC", name: "USD Coin", logo: "https://cryptologos.cc/logos/usd-coin-usdc-logo.png", coingeckoId: "usd-coin" },
            { symbol: "AETH", name: "Aether Token", logo: "https://placeholder.co/32?text=AETH", coingeckoId: "" },
            // Add more tokens as needed
        ];

        // DOM Elements
        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const swapBtn = document.getElementById('swapBtn');
        const selectFromToken = document.getElementById('selectFromToken');
        const selectToToken = document.getElementById('selectToToken');
        const switchTokens = document.getElementById('switchTokens');
        const tokenModal = document.getElementById('tokenModal');
        const popularTokensList = document.getElementById('popularTokens');
        const allTokensList = document.getElementById('allTokens');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadTokenLists();
            setupEventListeners();
        });

        function loadTokenLists() {
            // Popular tokens (first 3)
            popularTokensList.innerHTML = TOKENS.slice(0, 3).map(token => `
                <div class="token-item flex items-center p-3 hover:bg-gray-800 rounded-lg cursor-pointer" 
                     data-symbol="${token.symbol}" onclick="selectToken('${token.symbol}')">
                    <img src="${token.logo}" alt="${token.symbol}" class="w-8 h-8 rounded-full mr-3">
                    <div>
                        <div class="font-medium">${token.symbol}</div>
                        <div class="text-gray-400 text-xs">${token.name}</div>
                    </div>
                </div>
            `).join('');

            // All tokens
            allTokensList.innerHTML = TOKENS.map(token => `
                <div class="token-item flex items-center p-3 hover:bg-gray-800 rounded-lg cursor-pointer" 
                     data-symbol="${token.symbol}" onclick="selectToken('${token.symbol}')">
                    <img src="${token.logo}" alt="${token.symbol}" class="w-8 h-8 rounded-full mr-3">
                    <div>
                        <div class="font-medium">${token.symbol}</div>
                        <div class="text-gray-400 text-xs">${token.name}</div>
                    </div>
                </div>
            `).join('');
        }

        function setupEventListeners() {
            // Wallet Connection
            connectWalletBtn.addEventListener('click', connectWallet);

            // Token Selection
            selectFromToken.addEventListener('click', () => {
                currentSelection = 'from';
                tokenModal.classList.remove('hidden');
            });

            selectToToken.addEventListener('click', () => {
                currentSelection = 'to';
                tokenModal.classList.remove('hidden');
            });

            // Switch Tokens
            switchTokens.addEventListener('click', () => {
                const fromSymbol = document.getElementById('fromTokenSymbol').textContent;
                const fromImg = document.getElementById('fromTokenImg').src;
                const toSymbol = document.getElementById('toTokenSymbol').textContent;
                const toImg = document.getElementById('toTokenImg').src;
                
                document.getElementById('fromTokenSymbol').textContent = toSymbol;
                document.getElementById('fromTokenImg').src = toImg;
                document.getElementById('toTokenSymbol').textContent = fromSymbol;
                document.getElementById('toTokenImg').src = fromImg;
                
                updatePrice();
            });

            // Swap Button
            swapBtn.addEventListener('click', executeSwap);
        }

        // Wallet Connection
        async function connectWallet() {
            if (window.solana) {
                try {
                    wallet = window.solana;
                    if (!wallet.isConnected) {
                        await wallet.connect();
                    }
                    const publicKey = wallet.publicKey.toString();
                    connectWalletBtn.innerHTML = `<i class="fas fa-check-circle mr-2"></i> ${publicKey.slice(0,4)}...${publicKey.slice(-4)}`;
                    swapBtn.textContent = "Swap Now";
                    swapBtn.disabled = false;
                    
                    // Fetch balances
                    fetchBalances();
                } catch (error) {
                    console.error("Connection error:", error);
                    alert("Wallet connection failed");
                }
            } else {
                alert("Phantom Wallet not detected!");
            }
        }

        // Token Selection
        function selectToken(symbol) {
            const token = TOKENS.find(t => t.symbol === symbol);
            if (!token) return;

            if (currentSelection === 'from') {
                document.getElementById('fromTokenSymbol').textContent = token.symbol;
                document.getElementById('fromTokenImg').src = token.logo;
            } else {
                document.getElementById('toTokenSymbol').textContent = token.symbol;
                document.getElementById('toTokenImg').src = token.logo;
            }
            
            closeModal();
            updatePrice();
        }

        function closeModal() {
            tokenModal.classList.add('hidden');
        }

        // Price Calculation
        async function updatePrice() {
            const fromSymbol = document.getElementById('fromTokenSymbol').textContent;
            const toSymbol = document.getElementById('toTokenSymbol').textContent;
            
            // In a real DEX, you would fetch prices from an API or on-chain
            const fromToken = TOKENS.find(t => t.symbol === fromSymbol);
            const toToken = TOKENS.find(t => t.symbol === toSymbol);
            
            if (fromToken && toToken && fromToken.coingeckoId && toToken.coingeckoId) {
                try {
                    const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${fromToken.coingeckoId},${toToken.coingeckoId}&vs_currencies=usd`);
                    const prices = await response.json();
                    
                    const fromPrice = prices[fromToken.coingeckoId].usd;
                    const toPrice = prices[toToken.coingeckoId].usd;
                    const priceRatio = (fromPrice / toPrice).toFixed(4);
                    
                    document.getElementById('priceInfo').textContent = `1 ${fromSymbol} = ${priceRatio} ${toSymbol}`;
                } catch (error) {
                    console.error("Price fetch error:", error);
                    document.getElementById('priceInfo').textContent = `1 ${fromSymbol} = -- ${toSymbol}`;
                }
            } else {
                // Fallback for tokens without CoinGecko ID
                document.getElementById('priceInfo').textContent = `1 ${fromSymbol} = -- ${toSymbol}`;
            }
        }

        // Fetch Balances (simplified)
        async function fetchBalances() {
            if (!wallet?.publicKey) return;
            
            // In a real DEX, you would fetch actual token balances
            document.getElementById('fromBalance').textContent = "Balance: --";
            document.getElementById('toBalance').textContent = "Balance: --";
        }

        // Execute Swap (simplified)
        async function executeSwap() {
            if (!wallet?.publicKey) {
                alert("Please connect wallet first");
                return;
            }

            const fromAmount = document.getElementById('fromAmount').value;
            if (!fromAmount || parseFloat(fromAmount) <= 0) {
                alert("Please enter a valid amount");
                return;
            }

            swapBtn.disabled = true;
            swapBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Processing...';

            try {
                // In a real DEX, you would:
                // 1. Get route from Jupiter API or similar
                // 2. Build transaction
                // 3. Send and confirm
                
                // Simulate transaction delay
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                swapBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Swap Successful!';
                setTimeout(() => {
                    swapBtn.textContent = "Swap Now";
                    swapBtn.disabled = false;
                }, 3000);
                
            } catch (error) {
                console.error("Swap error:", error);
                swapBtn.textContent = "Swap Failed - Try Again";
                swapBtn.disabled = false;
            }
        }

        // Expose functions to global scope for HTML onclick
        window.selectToken = selectToken;
        window.closeModal = closeModal;
    </script>
</body>
</html>