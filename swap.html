<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AetherSwap - Decentralized Exchange</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@solana/web3.js@1.84.0/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://unpkg.com/@jup-ag/core@3.6.0/dist/index.iife.min.js"></script>
  <style>
    body {
      font-family: 'Space Grotesk', sans-serif;
      background-color: #0b0c12;
      color: white;
    }
    .gradient-text {
      background: linear-gradient(to right, #7c3aed, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .tab-active {
      color: #7c3aed;
      border-bottom: 2px solid #7c3aed;
    }
    .card-glow {
      border: 1px solid #7c3aed55;
      background: linear-gradient(135deg, rgba(124,58,237,0.1), rgba(59,130,246,0.1));
      box-shadow: 0 0 10px #7c3aed33;
    }
    .neon-card {
      border: 1px solid #3b82f6;
      background-color: rgba(59, 130, 246, 0.1);
      backdrop-filter: blur(4px);
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- NAVIGATION -->
  <nav class="flex justify-between items-center px-4 py-3 bg-gray-900 border-b border-gray-800">
    <div class="flex items-center space-x-2">
      <img src="logo.png" alt="Logo" class="w-8 h-8">
      <h1 class="text-lg font-bold gradient-text">AetherSwap</h1>
    </div>
    <button id="wallet-button" class="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-lg text-sm font-semibold">
      Connect Wallet
    </button>
  </nav>

  <!-- TABS -->
  <div class="flex justify-center space-x-6 bg-gray-900 border-b border-gray-800 py-3">
    <button class="tab-btn text-sm tab-active" data-tab="swap">Swap</button>
    <button class="tab-btn text-sm text-gray-400 hover:text-white" data-tab="limit">Limit</button>
    <button class="tab-btn text-sm text-gray-400 hover:text-white" data-tab="perpetual">Perpetual</button>
  </div>

  <!-- MAIN BODY -->
  <main class="flex-1 max-w-2xl w-full mx-auto p-4 space-y-6">

    <!-- BUY CARD -->
    <div class="neon-card rounded-xl px-4 py-3 flex justify-center">
      <span class="text-lg font-semibold text-indigo-400">Buy</span>
    </div>

    <!-- SWAP TAB -->
    <section id="tab-swap" class="tab-section">
      <!-- From Section -->
      <div class="bg-gray-800 rounded-xl p-4">
        <div class="flex justify-between mb-2">
          <span class="text-sm text-gray-400">From</span>
          <span class="text-xs text-gray-400">Balance: <span id="from-balance">0</span></span>
        </div>
        <div class="flex items-center space-x-2">
          <input type="number" id="from-amount" placeholder="0.0" class="flex-1 text-3xl bg-transparent outline-none text-white">
          <button id="from-max" class="text-xs px-2 py-1 bg-gray-700 rounded hover:bg-gray-600">Max</button>
          <button id="from-half" class="text-xs px-2 py-1 bg-gray-700 rounded hover:bg-gray-600">50%</button>
          <button id="from-token-select" class="flex items-center space-x-2 bg-gray-700 px-3 py-2 rounded-lg hover:bg-gray-600">
            <img src="https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png" class="w-5 h-5 rounded-full">
            <span>SOL</span>
          </button>
        </div>
        <div class="text-sm text-gray-500 mt-1">â‰ˆ $<span id="from-amount-usd">0.00</span></div>
      </div>

      <!-- Swap Arrow -->
      <div class="flex justify-center my-4">
        <button id="switch-tokens" class="bg-gray-700 p-2 rounded-full hover:bg-gray-600">
          <svg class="w-5 h-5 text-white transform rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
      </div>

      <!-- To Section -->
      <div class="bg-gray-800 rounded-xl p-4">
        <div class="flex justify-between mb-2">
          <span class="text-sm text-gray-400">To</span>
          <span class="text-xs text-gray-400">Balance: <span id="to-balance">0</span></span>
        </div>
        <div class="flex items-center space-x-2">
          <input type="number" id="to-amount" readonly placeholder="0.0" class="flex-1 text-3xl bg-transparent outline-none text-white">
          <button id="to-token-select" class="flex items-center space-x-2 bg-gray-700 px-3 py-2 rounded-lg hover:bg-gray-600">
            <div class="w-5 h-5 bg-gray-500 rounded-full flex items-center justify-center">
              <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
            </div>
            <span>Select</span>
          </button>
        </div>
        <div class="text-sm text-gray-500 mt-1">â‰ˆ $<span id="to-amount-usd">0.00</span></div>
      </div>
            <!-- Swap Details -->
      <div class="bg-gray-800 rounded-xl p-4 space-y-3">
        <div class="flex justify-between text-sm text-gray-400">
          <span>Price</span>
          <span id="price-ratio">-</span>
        </div>
        <div class="flex justify-between text-sm text-gray-400">
          <span>Minimum Received</span>
          <span id="min-received">-</span>
        </div>
        <div class="flex justify-between items-center text-sm text-gray-400">
          <span>Slippage Tolerance</span>
          <div class="space-x-2">
            <button class="bg-gray-700 px-2 py-1 rounded text-xs" data-slippage="0.5">0.5%</button>
            <button class="bg-gray-700 px-2 py-1 rounded text-xs" data-slippage="1.0">1%</button>
            <button class="bg-indigo-900 px-2 py-1 rounded text-xs" data-slippage="0.1">Custom</button>
          </div>
        </div>
      </div>

      <!-- Swap Button -->
      <button id="swap-button" class="w-full bg-indigo-600 hover:bg-indigo-700 py-3 rounded-xl mt-4 font-medium transition disabled:opacity-40" disabled>
        Connect Wallet
      </button>
    </section>

    <!-- LIMIT TAB -->
    <section id="tab-limit" class="tab-section hidden">
      <div class="text-center py-10 bg-gray-900 rounded-xl border border-gray-800">
        <h2 class="text-xl font-bold mb-2 text-indigo-400">Limit Orders ðŸ’¼</h2>
        <p class="text-sm text-gray-400">Coming Soon - Smart order routing with on-chain execution.</p>
      </div>
    </section>

    <!-- PERPETUAL TAB -->
    <section id="tab-perpetual" class="tab-section hidden">
      <div class="text-center py-10 bg-gray-900 rounded-xl border border-gray-800">
        <h2 class="text-xl font-bold mb-2 text-pink-500">Perpetual Trading âš¡</h2>
        <p class="text-sm text-gray-400">In dev: Monitor live meme coins with real-time prices and new token listing status.</p>
      </div>
    </section>

    <!-- Token Select Modal -->
    <div id="token-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
      <div class="bg-gray-900 border border-gray-800 rounded-xl w-full max-w-md mx-4">
        <div class="p-4 border-b border-gray-800 flex justify-between items-center">
          <h3 class="text-white font-semibold">Select Token</h3>
          <button id="close-token-modal" class="text-gray-400 hover:text-white text-xl">âœ•</button>
        </div>
        <div class="p-4">
          <div class="relative mb-4">
            <input id="token-search" type="text" placeholder="Paste token address or search..." class="w-full bg-gray-800 px-4 py-2 rounded-lg text-sm text-white outline-none" />
          </div>
          <div id="token-list" class="space-y-2 max-h-[300px] overflow-y-auto"></div>
        </div>
      </div>
    </div>

    <!-- TX Modal -->
    <div id="tx-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
      <div class="bg-gray-900 border border-gray-800 rounded-xl w-full max-w-md mx-4 text-center p-6">
        <div class="text-green-400 text-4xl mb-4">âœ”</div>
        <h3 class="text-white text-lg font-semibold mb-2">Swap Successful</h3>
        <p id="tx-summary" class="text-gray-300 mb-3">Swapped X SOL for Y TOKEN</p>
        <a id="tx-explorer-link" class="text-indigo-400 hover:underline text-sm" href="#" target="_blank">View on Solana Explorer</a>
        <button id="close-tx-modal" class="mt-4 text-sm text-gray-400 hover:text-white">Close</button>
      </div>
    </div>

    <!-- Chart Display (small) -->
    <div class="bg-gray-900 border border-gray-800 rounded-xl overflow-hidden mt-8">
      <div class="flex justify-between p-4 border-b border-gray-800">
        <h3 class="text-white text-sm font-medium" id="chart-pair-label">SOL / USDC</h3>
        <div class="space-x-2">
          <button data-interval="15m" class="text-xs bg-gray-800 px-2 py-1 rounded">15m</button>
          <button data-interval="1h" class="text-xs bg-gray-800 px-2 py-1 rounded">1H</button>
          <button data-interval="1d" class="text-xs bg-indigo-900 px-2 py-1 rounded">1D</button>
        </div>
      </div>
      <div id="price-chart" class="h-72">
        <!-- Embedded TradingView widget will go here -->
      </div>
    </div>
  </main>

  <!-- Footer Navigation -->
  <footer class="fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 flex justify-around py-2 text-xs">
    <a href="#" class="flex flex-col items-center text-indigo-400">
      <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4h16v16H4z" />
      </svg>
      <span>Swap</span>
    </a>
    <a href="#" class="flex flex-col items-center text-gray-400">
      <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m2 6H7" />
      </svg>
      <span>LaunchLab</span>
    </a>
    <a href="#" class="flex flex-col items-center text-gray-400">
      <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
      </svg>
      <span>Popular</span>
    </a>
  </footer>
    <!-- Script Global -->
  <script type="module">
    import {
      Connection,
      clusterApiUrl,
      PublicKey
    } from "https://unpkg.com/@solana/web3.js@1.84.0/lib/index.browser.mjs";

    import {
      Jupiter
    } from "https://unpkg.com/@jup-ag/core@3.6.0/dist/index.browser.mjs";

    const state = {
      connection: new Connection(clusterApiUrl("mainnet-beta"), "confirmed"),
      wallet: null,
      jupiter: null,
      tokenList: [],
      fromToken: null,
      toToken: null,
      slippage: 0.5,
    };

    async function initialize() {
      state.jupiter = await Jupiter.load({
        connection: state.connection,
        cluster: "mainnet-beta"
      });

      const tokenRes = await fetch("https://token.jup.ag/strict");
      state.tokenList = await tokenRes.json();

      state.fromToken = state.tokenList.find(t => t.symbol === "SOL");
      state.toToken = state.tokenList.find(t => t.symbol === "USDC");

      updateTokenUI();
      updatePreview();
    }

    // UI update
    function updateTokenUI() {
      const from = document.getElementById("from-token-select");
      const to = document.getElementById("to-token-select");

      if (state.fromToken) {
        from.querySelector("span").textContent = state.fromToken.symbol;
        from.querySelector("img").src = state.fromToken.logoURI || "";
      }

      if (state.toToken) {
        to.querySelector("span").textContent = state.toToken.symbol;
        to.querySelector("img").src = state.toToken.logoURI || "";
      }
    }

    // Event Listeners
    document.addEventListener("DOMContentLoaded", () => {
      initialize();

      document.getElementById("wallet-button").addEventListener("click", async () => {
        if (window.solana?.isPhantom) {
          try {
            const resp = await window.solana.connect();
            state.wallet = window.solana;
            document.getElementById("wallet-button").textContent =
              `${resp.publicKey.toString().slice(0, 4)}...${resp.publicKey.toString().slice(-4)}`;
            document.getElementById("swap-button").disabled = false;
          } catch (e) {
            alert("Wallet connection rejected");
          }
        } else {
          alert("Phantom Wallet not installed");
        }
      });

      // Input events
      document.getElementById("from-amount").addEventListener("input", () => {
        updatePreview();
      });

      // Switch tokens
      document.getElementById("switch-tokens").addEventListener("click", () => {
        const temp = state.fromToken;
        state.fromToken = state.toToken;
        state.toToken = temp;
        updateTokenUI();
        updatePreview();
      });

      // Open modal
      document.getElementById("from-token-select").addEventListener("click", () => {
        window.currentTokenSelect = "from";
        document.getElementById("token-modal").classList.remove("hidden");
      });

      document.getElementById("to-token-select").addEventListener("click", () => {
        window.currentTokenSelect = "to";
        document.getElementById("token-modal").classList.remove("hidden");
      });

      // Close modal
      document.getElementById("close-token-modal").addEventListener("click", () => {
        document.getElementById("token-modal").classList.add("hidden");
      });

      // Search tokens
      document.getElementById("token-search").addEventListener("input", (e) => {
        const q = e.target.value.toLowerCase();
        const results = state.tokenList.filter(t =>
          t.symbol.toLowerCase().includes(q) ||
          t.name.toLowerCase().includes(q) ||
          t.address.toLowerCase().includes(q)
        );

        const container = document.getElementById("token-list");
        container.innerHTML = "";
        results.slice(0, 30).forEach(token => {
          const el = document.createElement("div");
          el.className = "flex items-center p-2 rounded hover:bg-gray-800 cursor-pointer";
          el.innerHTML = `
            <img src="${token.logoURI}" class="w-6 h-6 rounded-full mr-3">
            <div>
              <div class="text-white text-sm">${token.symbol}</div>
              <div class="text-gray-400 text-xs">${token.name}</div>
            </div>`;
          el.onclick = () => {
            if (window.currentTokenSelect === "from") {
              state.fromToken = token;
            } else {
              state.toToken = token;
            }
            updateTokenUI();
            updatePreview();
            document.getElementById("token-modal").classList.add("hidden");
          };
          container.appendChild(el);
        });
      });

      // Close TX Modal
      document.getElementById("close-tx-modal").addEventListener("click", () => {
        document.getElementById("tx-modal").classList.add("hidden");
      });

      // Tabs Logic
      document.querySelectorAll(".tab-button").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("tab-active"));
          document.querySelectorAll(".tab-section").forEach(s => s.classList.add("hidden"));

          btn.classList.add("tab-active");
          document.getElementById(`tab-${btn.dataset.tab}`).classList.remove("hidden");
        });
      });
    });

    async function updatePreview() {
      const amount = parseFloat(document.getElementById("from-amount").value);
      if (!state.fromToken || !state.toToken || isNaN(amount)) return;

      const amountIn = Math.floor(amount * (10 ** state.fromToken.decimals));
      const quote = await state.jupiter.computeRoutes({
        inputMint: new PublicKey(state.fromToken.address),
        outputMint: new PublicKey(state.toToken.address),
        amount: amountIn,
        slippageBps: state.slippage * 100,
      });

      if (!quote || quote.routesInfos.length === 0) {
        document.getElementById("to-amount").value = '';
        document.getElementById("price-ratio").textContent = "No route";
        document.getElementById("min-received").textContent = "-";
        return;
      }

      const best = quote.routesInfos[0];
      const out = best.outAmount / (10 ** state.toToken.decimals);

      document.getElementById("to-amount").value = out.toFixed(6);
      document.getElementById("price-ratio").textContent = `1 ${state.fromToken.symbol} â‰ˆ ${(out / amount).toFixed(4)} ${state.toToken.symbol}`;
      document.getElementById("min-received").textContent = `${(out * (1 - state.slippage / 100)).toFixed(6)} ${state.toToken.symbol}`;
    }
        async function executeSwap() {
      const amount = parseFloat(document.getElementById("from-amount").value);
      if (!state.wallet || !state.fromToken || !state.toToken || isNaN(amount)) {
        return alert("Missing fields or wallet");
      }

      const amountIn = Math.floor(amount * (10 ** state.fromToken.decimals));
      const quote = await state.jupiter.computeRoutes({
        inputMint: new PublicKey(state.fromToken.address),
        outputMint: new PublicKey(state.toToken.address),
        amount: amountIn,
        slippageBps: state.slippage * 100,
      });

      if (!quote || quote.routesInfos.length === 0) return alert("No route available");

      const { execute } = await state.jupiter.exchange({
        routeInfo: quote.routesInfos[0]
      });

      const result = await execute();

      if (result.error) {
        alert("Swap failed");
      } else {
        document.getElementById("tx-summary").textContent = `Swapped ${amount} ${state.fromToken.symbol} to ${document.getElementById("to-amount").value} ${state.toToken.symbol}`;
        document.getElementById("tx-explorer-link").href = `https://solscan.io/tx/${result.txid}`;
        document.getElementById("tx-modal").classList.remove("hidden");
      }
    }

    // Chart Popup Open/Close
    document.getElementById("chart-popup-toggle").addEventListener("click", () => {
      document.getElementById("chart-popup").classList.remove("hidden");
    });

    document.getElementById("close-chart-popup").addEventListener("click", () => {
      document.getElementById("chart-popup").classList.add("hidden");
    });

  </script>

  <!-- Fullscreen Chart Modal -->
  <div id="chart-popup" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden flex items-center justify-center">
    <div class="relative w-full max-w-5xl h-[90vh] bg-gray-900 border border-gray-700 rounded-xl overflow-hidden">
      <div class="absolute top-2 right-2 z-10">
        <button id="close-chart-popup" class="text-white text-2xl font-bold hover:text-red-500">Ã—</button>
      </div>
      <iframe
        src="https://www.tradingview.com/embed-widget/mini-symbol-overview/?symbol=SOLUSDC&width=100%25&height=100%25&locale=en"
        style="width: 100%; height: 100%; border: none"
        allowtransparency="true"
        frameborder="0"
      ></iframe>
    </div>
  </div>

  <!-- Finalize -->
  <script>
    // Trading view responsive toggle future-ready
    document.querySelectorAll("[data-interval]").forEach(button => {
      button.addEventListener("click", () => {
        document.querySelectorAll("[data-interval]").forEach(b => {
          b.classList.remove("bg-indigo-900");
        });
        button.classList.add("bg-indigo-900");
      });
    });
  </script>
</body>
</html>