<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AetherSwap | Live Price Swap</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@solana/web3.js@1.70.1/lib/index.iife.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center font-sans">
  <div class="w-full max-w-md bg-gray-800 p-6 rounded-lg shadow-lg">
    <h1 class="text-2xl font-bold text-center mb-6">AetherSwap</h1>

    <button id="connectWallet" class="w-full mb-4 bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
      Connect Wallet
    </button>

    <label class="block text-sm mb-1">From Token (Mint)</label>
    <input id="fromToken" class="w-full mb-4 p-2 rounded bg-gray-700 text-white" placeholder="e.g. So111... (SOL)" />

    <label class="block text-sm mb-1">To Token (Mint)</label>
    <input id="toToken" class="w-full mb-4 p-2 rounded bg-gray-700 text-white" placeholder="e.g. EPjFWd... (USDC)" />

    <label class="block text-sm mb-1">Amount</label>
    <input id="amount" type="number" step="0.0001" class="w-full mb-4 p-2 rounded bg-gray-700 text-white" placeholder="1.0" />

    <button id="swapButton" class="w-full bg-green-500 hover:bg-green-600 px-4 py-2 rounded">
      Swap
    </button>

    <div id="status" class="mt-4 text-center text-sm text-gray-300">💡 Waiting for input...</div>
  </div>

  <script>
    const connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com");
    let wallet = null;

    // Connect Phantom Wallet
    document.getElementById("connectWallet").addEventListener("click", async () => {
      if (window.solana && window.solana.isPhantom) {
        try {
          await window.solana.connect();
          wallet = window.solana;
          const pubKey = wallet.publicKey.toString();
          document.getElementById("status").innerText = `✅ Connected: ${pubKey.slice(0, 4)}...${pubKey.slice(-4)}`;
        } catch (e) {
          document.getElementById("status").innerText = "❌ Wallet connection failed.";
        }
      } else {
        alert("Phantom Wallet is not installed!");
      }
    });

    // Get real-time price from Jupiter
    async function getSwapQuote(fromMint, toMint, amountUi) {
      const url = `https://quote-api.jup.ag/v6/quote?inputMint=${fromMint}&outputMint=${toMint}&amount=${Math.floor(amountUi * 1e6)}&slippageBps=100`;

      try {
        const res = await fetch(url);
        const json = await res.json();
        if (json?.data?.[0]) {
          const quote = json.data[0];
          const outAmount = quote.outAmount / 1e6;
          const rate = outAmount / amountUi;
          document.getElementById("status").innerText =
            `🔁 Rate: 1 = ${rate.toFixed(4)} | Receive: ${outAmount.toFixed(4)} ${toMint.slice(0, 4)}...`;
        } else {
          document.getElementById("status").innerText = "⚠️ No quote found for this pair.";
        }
      } catch (e) {
        document.getElementById("status").innerText = "❌ Failed to fetch quote.";
        console.error("Quote error:", e);
      }
    }

    // Auto update quote when user types
    ["fromToken", "toToken", "amount"].forEach(id => {
      document.getElementById(id).addEventListener("input", () => {
        const from = document.getElementById("fromToken").value.trim();
        const to = document.getElementById("toToken").value.trim();
        const amt = parseFloat(document.getElementById("amount").value.trim());
        if (from && to && amt > 0) getSwapQuote(from, to, amt);
      });
    });

    // Simulate the swap button
    document.getElementById("swapButton").addEventListener("click", () => {
      if (!wallet) return alert("Connect your wallet first.");
      const from = document.getElementById("fromToken").value.trim();
      const to = document.getElementById("toToken").value.trim();
      const amt = parseFloat(document.getElementById("amount").value.trim());
      if (!from || !to || amt <= 0) return alert("Please fill valid fields.");
      document.getElementById("status").innerHTML = '<i class="fas fa-spinner fa-spin"></i> Swapping...';
      setTimeout(() => {
        document.getElementById("status").innerText = `✅ Swap simulated: ${amt} from ${from.slice(0,4)}... to ${to.slice(0,4)}...`;
      }, 2000);
    });
  </script>
</body>
</html>