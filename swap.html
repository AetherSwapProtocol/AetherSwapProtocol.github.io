<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AetherSwap - Decentralized Exchange</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@solana/wallet-adapter-react-ui@latest/styles.css" />
  <script src="https://unpkg.com/@solana/web3.js@1.84.0/lib/index.iife.min.js"></script>
  <script src="https://unpkg.com/axios@1.5.0/dist/axios.min.js"></script>
  <style>
    body {
      background-color: #0b0b0f;
      font-family: 'Space Grotesk', sans-serif;
      color: white;
    }
    .gradient-text {
      background: linear-gradient(to right, #7e22ce, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .tab-active {
      background-color: #1e293b;
      color: #7c3aed;
      font-weight: bold;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Top Navbar -->
  <nav class="flex justify-between items-center px-6 py-4 bg-gray-900 border-b border-gray-800">
    <div class="flex items-center space-x-2">
      <img src="https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png" class="w-8 h-8" alt="logo" />
      <h1 class="text-xl font-bold gradient-text">AetherSwap</h1>
    </div>
    <div id="wallet-button" class="px-4 py-2 bg-indigo-600 rounded-lg text-sm font-semibold hover:bg-indigo-500 cursor-pointer">
      Connect Wallet
    </div>
  </nav>

  <!-- Tabs: Swap / Limit / Perpetual -->
  <div class="flex justify-center bg-gray-900 border-b border-gray-800">
    <button class="tab-button px-4 py-3 text-sm hover:bg-gray-800 transition tab-active" data-tab="swap">Swap</button>
    <button class="tab-button px-4 py-3 text-sm hover:bg-gray-800 transition" data-tab="limit">Limit</button>
    <button class="tab-button px-4 py-3 text-sm hover:bg-gray-800 transition" data-tab="perpetual">Perpetual</button>
  </div>

  <!-- Pages -->
  <main class="flex-1 p-4 max-w-3xl mx-auto w-full">
    <!-- SWAP PAGE -->
    <section id="tab-swap" class="tab-content block transition-opacity duration-300">
      <!-- On va ajouter ici la carte SWAP dans le bloc suivant -->
    </section>

    <!-- LIMIT PAGE -->
    <section id="tab-limit" class="tab-content hidden">
      <div class="bg-gray-800 rounded-xl p-6 text-center text-gray-400">
        <h2 class="text-lg font-semibold mb-2 text-white">Limit Orders ðŸš€</h2>
        <p>Coming soon. Stay tuned.</p>
      </div>
    </section>

    <!-- PERPETUAL PAGE -->
    <section id="tab-perpetual" class="tab-content hidden">
      <div class="bg-gray-800 rounded-xl p-6 text-center text-gray-400">
        <h2 class="text-lg font-semibold mb-2 text-white">Perpetual Trading ðŸ“ˆ</h2>
        <p>Work in progress. Stay tuned.</p>
      </div>
    </section>
  </main>

  <!-- Bottom Navbar -->
  <footer class="fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 flex justify-around py-3 text-sm">
    <a href="swap.html" class="flex flex-col items-center text-purple-400">
      <i class="fas fa-exchange-alt text-xl"></i>
      <span>Swap</span>
    </a>
    <button id="bottom-menu-btn" class="flex flex-col items-center text-white">
      <i class="fas fa-bars text-xl"></i>
      <span>Menu</span>
    </button>
    <a href="launchlab.html" class="flex flex-col items-center text-white">
      <i class="fas fa-rocket text-xl"></i>
      <span>LaunchLab</span>
    </a>
  </footer>

  <!-- JS toggle -->
  <script>
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('tab-active'));
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
        btn.classList.add('tab-active');
        document.getElementById('tab-' + btn.dataset.tab).classList.remove('hidden');
      });
    });
  </script>
</body>
</html>
<!-- Tabs: Swap / Limit / Perpetual -->
<div class="flex space-x-4 mb-4 mt-6 text-sm font-semibold text-white">
  <button class="tab-button text-indigo-500 border-b-2 border-indigo-500 pb-2" data-tab="swap">Swap</button>
  <button class="tab-button text-gray-400 hover:text-white pb-2" data-tab="limit">Limit</button>
  <button class="tab-button text-gray-400 hover:text-white pb-2" data-tab="perpetual">Perpetual</button>
</div>

<!-- BUY CARD neon style -->
<div class="mb-6">
  <div class="relative w-full max-w-sm bg-gradient-to-tr from-indigo-700/30 to-purple-700/30 rounded-xl border border-indigo-500 p-4 flex items-center shadow-lg">
    <div class="absolute inset-0 rounded-xl border-2 border-purple-900 blur-xl opacity-25"></div>
    <div class="relative w-full flex items-center justify-center">
      <span class="text-white font-bold text-xl tracking-wide">Buy</span>
    </div>
  </div>
</div>

<!-- Swap Content -->
<div id="tab-swap" class="tab-content">
  <!-- FROM TOKEN SECTION -->
  <div class="bg-gray-800 rounded-xl p-4 mb-4">
    <div class="flex justify-between items-center mb-2">
      <span class="text-sm text-gray-400">From</span>
      <span class="text-xs text-gray-400">Balance: <span id="from-balance">0</span></span>
    </div>
    <div class="flex items-center">
      <input 
        type="number" 
        id="from-amount" 
        placeholder="0.0" 
        class="bg-transparent text-3xl w-full outline-none"
        value="0"
      >
      <div class="flex items-center space-x-2 ml-4">
        <button class="bg-gray-700 text-xs px-2 py-1 rounded hover:bg-gray-600 transition" id="from-max">Max</button>
        <button class="bg-gray-700 text-xs px-2 py-1 rounded hover:bg-gray-600 transition" id="from-half">50%</button>
        <button id="from-token-select" class="flex items-center space-x-2 bg-gray-700 px-3 py-2 rounded-lg hover:bg-gray-600 transition">
          <img src="https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png" class="w-6 h-6 rounded-full">
          <span>SOL</span>
          <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
      </div>
    </div>
    <div class="text-sm text-gray-400 mt-2">â‰ˆ $<span id="from-amount-usd">0.00</span></div>
  </div>

  <!-- Swap Arrow -->
  <div class="flex justify-center my-2">
    <button id="switch-tokens" class="bg-gray-800 p-2 rounded-full border-2 border-gray-900 hover:bg-gray-700 transition transform hover:rotate-180 duration-300">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
      </svg>
    </button>
  </div>

  <!-- TO TOKEN SECTION -->
  <div class="bg-gray-800 rounded-xl p-4 mb-6">
    <div class="flex justify-between items-center mb-2">
      <span class="text-sm text-gray-400">To</span>
      <span class="text-xs text-gray-400">Balance: <span id="to-balance">0</span></span>
    </div>
    <div class="flex items-center">
      <input 
        type="number" 
        id="to-amount" 
        placeholder="0.0" 
        class="bg-transparent text-3xl w-full outline-none"
        readonly
      >
      <button id="to-token-select" class="flex items-center space-x-2 bg-gray-700 px-3 py-2 rounded-lg hover:bg-gray-600 transition ml-4">
        <div class="w-6 h-6 rounded-full bg-gray-600 flex items-center justify-center">
          <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
        </div>
        <span>Select</span>
        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>
    </div>
    <div class="text-sm text-gray-400 mt-2">â‰ˆ $<span id="to-amount-usd">0.00</span></div>
  </div>
</div>
<!-- Swap Details -->
<div class="bg-gray-800 rounded-xl p-4 mb-6">
  <div class="flex justify-between items-center mb-3">
    <span class="text-sm text-gray-400">Price</span>
    <span class="text-sm" id="price-ratio">-</span>
  </div>
  <div class="flex justify-between items-center mb-3">
    <span class="text-sm text-gray-400">Minimum Received</span>
    <span class="text-sm" id="min-received">-</span>
  </div>
  <div class="flex justify-between items-center">
    <span class="text-sm text-gray-400">Slippage Tolerance</span>
    <div class="flex items-center space-x-2">
      <button class="text-xs bg-gray-700 px-2 py-1 rounded hover:bg-gray-600 transition" data-slippage="0.5">0.5%</button>
      <button class="text-xs bg-gray-700 px-2 py-1 rounded hover:bg-gray-600 transition" data-slippage="1.0">1.0%</button>
      <button class="text-xs bg-indigo-900 px-2 py-1 rounded" data-slippage="0.1">Custom</button>
    </div>
  </div>
</div>

<!-- Swap Button -->
<button id="swap-button" class="w-full bg-indigo-600 hover:bg-indigo-700 py-4 rounded-xl font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed">
  Connect Wallet
</button>

<!-- LIMIT TAB -->
<div id="tab-limit" class="tab-content hidden text-center text-gray-400 text-sm">
  <div class="p-6 border border-dashed border-gray-700 rounded-xl mt-6">
    Coming soon: Limit Orders ðŸš€
  </div>
</div>

<!-- PERPETUAL TAB -->
<div id="tab-perpetual" class="tab-content hidden text-center text-gray-400 text-sm">
  <div class="p-6 border border-dashed border-gray-700 rounded-xl mt-6">
    Coming soon: Perpetual Trading ðŸ“‰ðŸ“ˆ
  </div>
</div>

<!-- Price Chart -->
<div class="bg-gray-900 rounded-xl shadow-lg border border-gray-800 overflow-hidden mt-10">
  <div class="p-4 border-b border-gray-800 flex justify-between items-center">
    <h3 class="font-medium text-white" id="chart-pair">SOL/USDC</h3>
    <div class="flex space-x-2">
      <button class="text-xs bg-gray-800 px-3 py-1 rounded hover:bg-gray-700 transition" data-interval="15m">15m</button>
      <button class="text-xs bg-gray-800 px-3 py-1 rounded hover:bg-gray-700 transition" data-interval="1h">1h</button>
      <button class="text-xs bg-indigo-900 px-3 py-1 rounded" data-interval="1d">1D</button>
      <button class="text-xs bg-gray-800 px-3 py-1 rounded hover:bg-gray-700 transition" data-interval="1w">1W</button>
    </div>
  </div>
  <div id="price-chart" class="h-96 w-full"></div>
</div>
<!-- Token Select Modal -->
<div id="token-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
  <div class="bg-gray-900 rounded-xl w-full max-w-md max-h-[80vh] mx-4 overflow-hidden border border-gray-800">
    <div class="p-4 border-b border-gray-800 flex justify-between items-center">
      <h3 class="font-medium text-white">Select Token</h3>
      <div class="relative w-1/2">
        <input 
          type="text" 
          id="token-search" 
          placeholder="Search name or paste address" 
          class="w-full bg-gray-800 rounded-lg px-4 py-2 text-sm outline-none pl-10 text-white"
        >
        <svg class="absolute left-3 top-2.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </div>
      <button id="close-token-modal" class="text-gray-400 hover:text-white">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="p-4">
      <div id="token-list" class="max-h-[60vh] overflow-y-auto space-y-2">
        <!-- Tokens chargÃ©s dynamiquement ici -->
      </div>
    </div>
  </div>
</div>

<!-- Transaction Confirmation Modal -->
<div id="tx-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
  <div class="bg-gray-900 rounded-xl w-full max-w-md mx-4 overflow-hidden border border-gray-800">
    <div class="p-4 border-b border-gray-800 flex justify-between items-center">
      <h3 class="font-medium text-white">Transaction Submitted</h3>
      <button id="close-tx-modal" class="text-gray-400 hover:text-white">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="p-6 text-center">
      <div class="w-16 h-16 bg-indigo-900 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
      </div>
      <h4 class="text-lg font-medium text-white mb-2">Swap Completed</h4>
      <p class="text-gray-400 mb-4" id="tx-summary">Swapped 0 SOL for 0 USDC</p>
      <a id="tx-explorer-link" href="#" target="_blank" class="text-indigo-500 hover:text-indigo-400 text-sm">View on Solana Explorer</a>
    </div>
  </div>
</div>

<!-- Tabs handler -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabs = ['swap', 'limit', 'perpetual'];
    tabs.forEach(tab => {
      document.getElementById(`tab-${tab}`)?.classList.add('hidden');
    });
    document.getElementById('tab-swap')?.classList.remove('hidden');

    tabs.forEach(tab => {
      const btn = document.getElementById(`btn-${tab}`);
      if (btn) {
        btn.addEventListener('click', () => {
          tabs.forEach(t => {
            document.getElementById(`tab-${t}`)?.classList.add('hidden');
            document.getElementById(`btn-${t}`)?.classList.remove('text-white', 'border-b-2', 'border-indigo-500');
            document.getElementById(`btn-${t}`)?.classList.add('text-gray-500');
          });
          document.getElementById(`tab-${tab}`)?.classList.remove('hidden');
          btn.classList.remove('text-gray-500');
          btn.classList.add('text-white', 'border-b-2', 'border-indigo-500');
        });
      }
    });
  });
</script>
<script type="module">
import {
  Connection,
  clusterApiUrl,
  PublicKey
} from "https://unpkg.com/@solana/web3.js@1.84.0/lib/index.browser.mjs";

import {
  Jupiter,
} from "https://unpkg.com/@jup-ag/core@3.6.0/dist/index.browser.mjs";

let state = {
  connection: null,
  wallet: null,
  jupiter: null,
  tokenList: [],
  fromToken: null,
  toToken: null,
  slippage: 0.5,
};

document.addEventListener("DOMContentLoaded", async () => {
  state.connection = new Connection(clusterApiUrl("mainnet-beta"), "confirmed");

  try {
    state.jupiter = await Jupiter.load({
      connection: state.connection,
      cluster: "mainnet-beta",
    });

    await loadTokens();
    setupWalletConnect();
    setupSearchModal();
    setupQuote();
    setupSwap();
  } catch (err) {
    console.error("Init error", err);
    alert("Erreur d'initialisation de l'application");
  }
});

async function loadTokens() {
  try {
    const res = await fetch("https://token.jup.ag/strict");
    const data = await res.json();
    state.tokenList = data;

    console.log(`ðŸŽ¯ ${state.tokenList.length} tokens loaded`);
  } catch (e) {
    console.error("Token list load failed", e);
  }
}

function setupWalletConnect() {
  const btn = document.getElementById("wallet-button");
  btn.addEventListener("click", async () => {
    try {
      const resp = await window.solana.connect();
      state.wallet = window.solana;
      btn.textContent = `${resp.publicKey.toString().slice(0, 4)}...${resp.publicKey.toString().slice(-4)}`;
      document.getElementById("swap-button").disabled = false;
    } catch (err) {
      alert("Connexion wallet refusÃ©e");
    }
  });
}

function setupSearchModal() {
  document.getElementById("token-search").addEventListener("input", e => {
    const q = e.target.value.toLowerCase();
    const list = document.getElementById("token-list");
    list.innerHTML = "";

    const found = state.tokenList.filter(t =>
      t.symbol.toLowerCase().includes(q) ||
      t.name.toLowerCase().includes(q) ||
      t.address.toLowerCase().includes(q)
    );

    for (const token of found.slice(0, 30)) {
      const div = document.createElement("div");
      div.className = "token-item flex items-center p-3 hover:bg-gray-800 rounded-lg cursor-pointer";
      div.innerHTML = `
        <img src="${token.logoURI}" class="w-8 h-8 rounded-full mr-3">
        <div>
          <div class="font-medium">${token.symbol}</div>
          <div class="text-xs text-gray-400">${token.name}</div>
        </div>`;
      div.onclick = () => {
        document.getElementById("token-modal").classList.add("hidden");
        state.toToken = token;
        updatePreview();
      };
      list.appendChild(div);
    }
  });
}

function setupQuote() {
  document.getElementById("from-amount").addEventListener("input", async (e) => {
    const amt = parseFloat(e.target.value);
    if (!state.fromToken || !state.toToken || isNaN(amt)) return;
    await updatePreview();
  });
}

async function updatePreview() {
  const amt = parseFloat(document.getElementById("from-amount").value);
  if (!state.fromToken || !state.toToken || isNaN(amt)) return;

  const amountIn = Math.floor(amt * 10 ** state.fromToken.decimals);
  const route = await state.jupiter.computeRoutes({
    inputMint: new PublicKey(state.fromToken.address),
    outputMint: new PublicKey(state.toToken.address),
    amount: amountIn,
    slippageBps: state.slippage * 100,
  });

  if (route.routesInfos.length === 0) {
    document.getElementById("to-amount").value = "N/A";
    document.getElementById("price-ratio").textContent = "No route found";
    document.getElementById("min-received").textContent = "-";
    return;
  }

  const best = route.routesInfos[0];
  const out = best.outAmount / 10 ** state.toToken.decimals;
  document.getElementById("to-amount").value = out.toFixed(6);
  document.getElementById("price-ratio").textContent = `1 ${state.fromToken.symbol} â‰ˆ ${(out / amt).toFixed(4)} ${state.toToken.symbol}`;
  document.getElementById("min-received").textContent = `${(out * (1 - state.slippage / 100)).toFixed(6)} ${state.toToken.symbol}`;
}

function setupSwap() {
  document.getElementById("swap-button").addEventListener("click", async () => {
    if (!state.wallet || !state.toToken || !state.fromToken) {
      return alert("Veuillez connecter le wallet et sÃ©lectionner les tokens");
    }

    const amount = parseFloat(document.getElementById("from-amount").value);
    const amountIn = Math.floor(amount * 10 ** state.fromToken.decimals);
    const quote = await state.jupiter.computeRoutes({
      inputMint: new PublicKey(state.fromToken.address),
      outputMint: new PublicKey(state.toToken.address),
      amount: amountIn,
      slippageBps: state.slippage * 100,
    });

    if (!quote || quote.routesInfos.length === 0) return alert("Aucun chemin disponible");

    const { execute } = await state.jupiter.exchange({
      routeInfo: quote.routesInfos[0],
    });

    const res = await execute();
    if (res.error) {
      alert("Ã‰chec du swap");
    } else {
      document.getElementById("tx-summary").textContent = `Swapped ${amount} ${state.fromToken.symbol} for ${document.getElementById("to-amount").value} ${state.toToken.symbol}`;
      document.getElementById("tx-explorer-link").href = `https://solscan.io/tx/${res.txid}`;
      document.getElementById("tx-modal").classList.remove("hidden");
    }
  });
}
</script>
<!-- Final Token Modals & Navigation -->
<div id="token-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
  <div class="bg-gray-900 rounded-xl w-full max-w-md overflow-hidden border border-gray-800">
    <div class="p-4 border-b border-gray-800 flex justify-between items-center">
      <h3 class="font-medium text-white">Select Token</h3>
      <input id="token-search" placeholder="Paste token address or search..." class="w-1/2 ml-4 bg-gray-800 text-sm px-3 py-2 rounded-lg focus:outline-none">
      <button id="close-token-modal" class="text-gray-400 hover:text-white">
        âœ•
      </button>
    </div>
    <div class="p-4">
      <div id="token-list" class="max-h-[300px] overflow-y-auto space-y-2">
        <!-- Loaded dynamically -->
      </div>
    </div>
  </div>
</div>

<div id="tx-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
  <div class="bg-gray-900 rounded-xl w-full max-w-sm mx-4 border border-gray-800">
    <div class="p-4 border-b border-gray-800 flex justify-between items-center">
      <h3 class="text-lg font-medium text-white">Transaction Confirmed</h3>
      <button id="close-tx-modal" class="text-gray-400 hover:text-white">âœ•</button>
    </div>
    <div class="p-6 text-center">
      <div class="text-green-400 text-4xl mb-2">âœ”</div>
      <div id="tx-summary" class="text-gray-300 mb-4">Swapped successfully</div>
      <a id="tx-explorer-link" class="text-indigo-500 hover:underline text-sm" target="_blank">View on Solana Explorer</a>
    </div>
  </div>
</div>

<!-- Tab Navigation (Swap / Limit / Perps) -->
<div class="flex justify-around mt-6 mb-4 border-b border-gray-700">
  <button class="tab-btn py-2 px-6 text-gray-400 hover:text-white border-b-2 border-transparent active-tab" data-tab="swap">Swap</button>
  <button class="tab-btn py-2 px-6 text-gray-400 hover:text-white border-b-2 border-transparent" data-tab="limit">Limit</button>
  <button class="tab-btn py-2 px-6 text-gray-400 hover:text-white border-b-2 border-transparent" data-tab="perps">Perpetual</button>
</div>

<!-- Buy Card above Swap Form -->
<div class="w-full flex justify-start mb-4">
  <div class="bg-gradient-to-r from-purple-800 via-indigo-700 to-blue-600 rounded-xl px-6 py-3 shadow-lg text-white text-sm font-semibold flex items-center space-x-3 cursor-pointer hover:scale-105 transition">
    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h11M9 21V3m0 18l4-4m-4 4l-4-4" />
    </svg>
    <span>Buy</span>
  </div>
</div>

<!-- Page Switching Logic -->
<script>
  const tabs = document.querySelectorAll(".tab-btn");
  tabs.forEach(btn => {
    btn.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("border-indigo-500", "text-white", "active-tab"));
      btn.classList.add("border-indigo-500", "text-white", "active-tab");

      // Simulate internal navigation
      const tab = btn.dataset.tab;
      document.querySelectorAll(".tab-content").forEach(c => c.classList.add("hidden"));
      document.getElementById(`${tab}-tab`).classList.remove("hidden");
    });
  });

  // Close modals
  document.getElementById("close-token-modal").onclick = () => {
    document.getElementById("token-modal").classList.add("hidden");
  };
  document.getElementById("close-tx-modal").onclick = () => {
    document.getElementById("tx-modal").classList.add("hidden");
  };
</script>

<!-- Final Responsive Fix -->
<style>
  .tab-btn.active-tab {
    border-bottom: 2px solid #6366F1;
  }
</style>
        // Execute swap
        async function executeSwap(amount) {
          const swapButton = document.getElementById('swap-button');
          swapButton.disabled = true;
          swapButton.textContent = 'Confirm in Wallet...';

          try {
            const amountInLamports = Math.floor(amount * Math.pow(10, state.fromToken.decimals));
            
            // Get quote
            const quote = await state.jupiter.computeRoutes({
              inputMint: new solanaWeb3.PublicKey(state.fromToken.mint),
              outputMint: new solanaWeb3.PublicKey(state.toToken.mint),
              amount: amountInLamports,
              slippageBps: state.slippage * 100,
            });

            if (quote.routesInfos.length === 0) {
              throw new Error('No swap route found');
            }

            // Execute swap
            const { execute } = await state.jupiter.exchange({
              routeInfo: quote.routesInfos[0]
            });

            const swapResult = await execute();

            // Show success modal
            document.getElementById('tx-summary').textContent = `Swapped ${amount} ${state.fromToken.symbol} for ${document.getElementById('to-amount').value} ${state.toToken.symbol}`;
            document.getElementById('tx-explorer-link').href = `https://solscan.io/tx/${swapResult.txid}`;
            document.getElementById('tx-modal').classList.remove('hidden');

            // Update balances
            updateTokenBalances();
          } catch (err) {
            console.error('Swap failed:', err);
            alert(`Swap failed: ${err.message}`);
          } finally {
            swapButton.disabled = false;
            swapButton.textContent = 'Swap';
          }
        }

    </script>
</body>
</html>