<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Discover trending tokens on AetherSwap, ranked by volume and performance"/>
  <meta name="theme-color" content="#121212"/>
  <title>AetherSwap – Popular Tokens</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <!-- Preload critical resources -->
  <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --bg-primary: #121212;
      --bg-secondary: #1F1F1F;
      --bg-accent: rgba(255,255,255,0.05);
      --text-primary: #FFFFFF;
      --text-secondary: #A3A3A3;
      --gradient-primary: linear-gradient(135deg, #2563EB 0%, #7C3AED 100%);
    }
    
    body {
      margin: 0;
      padding-bottom: 120px;
      font-family: 'Inter', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }
    
    .glass {
      background: var(--bg-accent);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .time-tab {
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .time-tab.active {
      background: var(--gradient-primary);
    }
    
    .network-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background: var(--bg-secondary);
      border-radius: 12px;
      z-index: 10;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      max-height: 300px;
      overflow-y: auto;
    }
    
    .network-dropdown.active {
      display: block;
    }
    
    .network-item {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    
    .network-item:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .network-item.selected {
      background: rgba(255,255,255,0.1);
    }
    
    .token-row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      cursor: pointer;
    }
    
    .token-row:hover {
      background: rgba(255,255,255,0.03);
    }
    
    .token-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .token-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
    }
    
    .price-up {
      color: #10B981;
    }
    
    .price-down {
      color: #EF4444;
    }
    
    .modal-bg {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
      z-index: 50;
      animation: fadeIn 0.2s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .token-modal {
      width: 90%;
      max-width: 420px;
      border-radius: 16px;
      background: var(--bg-secondary);
      overflow: hidden;
    }
    
    .token-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .token-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      padding: 16px;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      padding: 12px;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .stat-value {
      font-weight: 500;
    }
    
    .contract-address {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      margin: 16px;
    }
    
    .time-tabs {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 16px;
      scrollbar-width: none;
    }
    
    .time-tabs::-webkit-scrollbar {
      display: none;
    }
    
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .pulse {
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }
  </style>
</head>
<body>

  <!-- TOP BAR -->
  <header class="sticky top-0 z-40 bg-black/80 backdrop-blur-sm p-4 border-b border-white/5">
    <h1 class="text-lg font-semibold text-center">Popular Tokens</h1>
  </header>

  <!-- TIME FILTER -->
  <div class="time-tabs">
    <div class="time-tab active">1H</div>
    <div class="time-tab">24H</div>
    <div class="time-tab">7D</div>
    <div class="time-tab">1M</div>
    <div class="time-tab">ALL</div>
  </div>

  <!-- NETWORK SELECTOR -->
  <div class="px-4 mb-3 relative">
    <button id="networkSelector" class="w-full p-3 bg-[#1F1F1F] rounded-lg flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span>All Networks</span>
      </div>
      <span>▼</span>
    </button>
    <div id="networkDropdown" class="network-dropdown">
      <div class="network-item selected">
        <div class="flex items-center gap-3 w-full">
          <span>All Networks</span>
        </div>
      </div>
      <div class="network-item">
        <div class="flex items-center gap-3 w-full">
          <img src="https://cryptologos.cc/logos/ethereum-eth-logo.png?v=025" class="w-5 h-5 rounded-full" alt="Ethereum"/>
          <span>Ethereum</span>
        </div>
      </div>
      <div class="network-item">
        <div class="flex items-center gap-3 w-full">
          <img src="https://cryptologos.cc/logos/solana-sol-logo.png?v=025" class="w-5 h-5 rounded-full" alt="Solana"/>
          <span>Solana</span>
        </div>
      </div>
      <div class="network-item">
        <div class="flex items-center gap-3 w-full">
          <img src="https://cryptologos.cc/logos/binance-coin-bnb-logo.png?v=025" class="w-5 h-5 rounded-full" alt="BNB Chain"/>
          <span>BNB Chain</span>
        </div>
      </div>
      <div class="network-item">
        <div class="flex items-center gap-3 w-full">
          <img src="https://cryptologos.cc/logos/polygon-matic-logo.png?v=025" class="w-5 h-5 rounded-full" alt="Polygon"/>
          <span>Polygon</span>
        </div>
      </div>
      <div class="network-item">
        <div class="flex items-center gap-3 w-full">
          <img src="https://cryptologos.cc/logos/arbitrum-arb-logo.png?v=025" class="w-5 h-5 rounded-full" alt="Arbitrum"/>
          <span>Arbitrum</span>
        </div>
      </div>
    </div>
  </div>

  <!-- TOKEN LIST HEADER -->
  <div class="px-4 grid grid-cols-3 text-sm text-gray-400 mb-2">
    <div class="pl-4">Token</div>
    <div class="text-right">Price</div>
    <div class="text-right pr-4">Volume</div>
  </div>

  <!-- TOKEN LIST -->
  <main id="tokenList" class="glass mx-4 rounded-xl overflow-hidden">
    <!-- Token rows will be inserted here by JavaScript -->
  </main>

  <!-- LOADING INDICATOR -->
  <div id="loadingIndicator" class="text-center py-4 text-gray-400 text-sm pulse">Loading tokens...</div>

  <!-- Modal: Token Detail -->
  <div id="tokenModal" class="modal-bg">
    <div class="token-modal">
      <div class="token-header">
        <div class="flex justify-between items-start mb-4">
          <div>
            <h2 id="modalName" class="text-xl font-bold">TRUMP</h2>
            <p id="modalChain" class="text-sm text-gray-400">SPL • Solana</p>
          </div>
          <div class="text-right">
            <p id="modalPrice" class="text-xl font-bold">9.52 €</p>
            <p id="modalChange" class="text-sm price-up">+1.41%</p>
          </div>
        </div>
        <div class="time-tabs">
          <div class="time-tab active">1H</div>
          <div class="time-tab">1D</div>
          <div class="time-tab">1W</div>
          <div class="time-tab">1M</div>
          <div class="time-tab">1Y</div>
          <div class="time-tab">ALL</div>
        </div>
      </div>
      
      <div class="p-4">
        <h3 class="font-medium mb-2">About TRUMP</h3>
        <p class="text-sm text-gray-300 mb-4">$TRUMP are now freely tradeable on the blockchain.</p>
        <a href="#" class="text-blue-400 text-sm font-medium">Learn more</a>
        
        <div class="bg-yellow-900/20 border border-yellow-800 rounded-lg p-3 mt-4 mb-6">
          <p class="text-yellow-400 text-sm">Note: OFFICIAL TRUMP is not currently scanned by Go+. Please do your own research (DYOR).</p>
        </div>
        
        <h3 class="font-medium mb-3">Statistics</h3>
        <div class="token-stats">
          <div class="stat-item">
            <div class="stat-label">Market Cap</div>
            <div class="stat-value">1.90B €</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Circulating Supply</div>
            <div class="stat-value">199.99M TRUMP</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Total Supply</div>
            <div class="stat-value">999.99M TRUMP</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Volume (24h)</div>
            <div class="stat-value">32.54M €</div>
          </div>
        </div>
        
        <h3 class="font-medium mb-3 mt-6">Contract Address</h3>
        <div class="contract-address">
          <span class="text-sm font-mono">6p6xgH...GIPN</span>
          <button class="text-blue-400 text-sm font-medium">Copy</button>
        </div>
        
        <h3 class="font-medium mb-3 mt-6">Links</h3>
        <div class="grid grid-cols-3 gap-3">
          <a href="#" class="bg-[#1F1F1F] rounded-lg p-3 text-center text-sm">Website</a>
          <a href="#" class="bg-[#1F1F1F] rounded-lg p-3 text-center text-sm">Explorer</a>
          <a href="#" class="bg-[#1F1F1F] rounded-lg p-3 text-center text-sm">CMC</a>
        </div>
        
        <button class="w-full bg-gradient-to-r from-blue-600 to-purple-600 py-3 rounded-lg font-medium mt-6">Swap Token</button>
      </div>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <nav class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-black/50 backdrop-blur-md border border-white/10 flex items-center justify-between px-6 py-2 w-[calc(100%-32px)] max-w-[360px] rounded-full z-40">
    <a href="index.html" class="flex flex-col items-center text-xs p-2 rounded-lg hover:bg-white/5 transition-colors">
      <img src="/icons/home.svg" class="w-5 h-5 mb-1" alt="Home"/>
      <span>Home</span>
    </a>
    <a href="popular.html" class="flex flex-col items-center text-xs p-2 rounded-lg hover:bg-white/5 transition-colors">
      <img src="/icons/trending_up.svg" class="w-5 h-5 mb-1" alt="Popular"/>
      <span>Popular</span>
    </a>
    <div class="w-12"></div>
    <a href="wallet.html" class="flex flex-col items-center text-xs p-2 rounded-lg hover:bg-white/5 transition-colors">
      <img src="/icons/account_balance_wallet.svg" class="w-5 h-5 mb-1" alt="Wallet"/>
      <span>Wallet</span>
    </a>
    <a href="settings.html" class="flex flex-col items-center text-xs p-2 rounded-lg hover:bg-white/5 transition-colors">
      <img src="/icons/settings.svg" class="w-5 h-5 mb-1" alt="Settings"/>
      <span>Settings</span>
    </a>
    <a href="swap.html" class="absolute -top-6 left-1/2 transform -translate-x-1/2 hover:scale-105 transition-transform">
      <div class="w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-full border-4 border-black flex items-center justify-center shadow-lg hover:shadow-xl transition-all">
        <img src="/icons/swap_horiz.svg" class="w-7 h-7 text-white" alt="Swap"/>
      </div>
    </a>
  </nav>

  <script>
    // Configuration
    const PAGE_SIZE = 20;
    const chains = [
      { id: 'all', name: 'All Networks', logo: null },
      { id: 'ethereum', name: 'Ethereum', logo: 'https://cryptologos.cc/logos/ethereum-eth-logo.png?v=025' },
      { id: 'solana', name: 'Solana', logo: 'https://cryptologos.cc/logos/solana-sol-logo.png?v=025' },
      { id: 'bnb', name: 'BNB Chain', logo: 'https://cryptologos.cc/logos/binance-coin-bnb-logo.png?v=025' },
      { id: 'polygon', name: 'Polygon', logo: 'https://cryptologos.cc/logos/polygon-matic-logo.png?v=025' },
      { id: 'arbitrum', name: 'Arbitrum', logo: 'https://cryptologos.cc/logos/arbitrum-arb-logo.png?v=025' },
      { id: 'base', name: 'Base', logo: 'https://cryptologos.cc/logos/base-logo.png?v=025' },
      { id: 'optimism', name: 'Optimism', logo: 'https://cryptologos.cc/logos/optimism-ethereum-op-logo.png?v=025' }
    ];
    
    // Sample token data - in a real app this would come from an API
    const sampleTokens = [
      {
        id: 'trump',
        name: 'TRUMP',
        symbol: 'TRUMP',
        chain: 'solana',
        price: 9.5379,
        change24h: -0.38,
        volume: 32540000,
        marketCap: 1904568986.35,
        circulatingSupply: 199999367.163,
        totalSupply: 999999391.527,
        contract: '6p6xgH...GIPN',
        about: '$TRUMP are now freely tradeable on the blockchain.',
        warning: 'OFFICIAL TRUMP is not currently scanned by Go+. Please do your own research (DYOR).'
      },
      {
        id: 'launchcoin',
        name: 'LAUNCHCOIN',
        symbol: 'LAUNCH',
        chain: 'ethereum',
        price: 0.19943,
        change24h: -1.74,
        volume: 19590000
      },
      {
        id: 'jlp',
        name: 'JLP',
        symbol: 'JLP',
        chain: 'bnb',
        price: 4.0378,
        change24h: -0.33,
        volume: 19020000
      },
      {
        id: 'aura',
        name: 'Aura',
        symbol: 'AURA',
        chain: 'ethereum',
        price: 0.027601,
        change24h: -15.03,
        volume: 17630000
      },
      {
        id: 'mcgaa',
        name: 'MCGAA',
        symbol: 'MCGAA',
        chain: 'solana',
        price: 0.0034715,
        change24h: 0.32,
        volume: 16360000
      },
      {
        id: 'encode',
        name: 'ENCODE',
        symbol: 'ENCODE',
        chain: 'bnb',
        price: 0.0037497,
        change24h: 0.03,
        volume: 15260000
      },
      {
        id: 'chester',
        name: 'Chester',
        symbol: 'CHESTER',
        chain: 'solana',
        price: 0.0058471,
        change24h: 0.04,
        volume: 14960000
      },
      {
        id: 'fartcoin',
        name: 'Fartcoin',
        symbol: 'FART',
        chain: 'ethereum',
        price: 1.1685,
        change24h: 0.28,
        volume: 13510000
      },
      {
        id: 'crybb',
        name: 'CryBB',
        symbol: 'CRYBB',
        chain: 'bnb',
        price: 0.0086001,
        change24h: 0.08,
        volume: 11290000
      },
      {
        id: 'chloe',
        name: 'CHLOE',
        symbol: 'CHLOE',
        chain: 'solana',
        price: 0.0027453,
        change24h: -0.00,
        volume: 8670000
      },
      {
        id: 'toli',
        name: 'Toli',
        symbol: 'TOLI',
        chain: 'ethereum',
        price: 0.00083376,
        change24h: -0.28,
        volume: 8500000
      }
    ];

    // State management
    let currentChain = 'all';
    let currentTime = '24h';
    let allTokens = [];
    let renderedCount = 0;
    let isLoading = false;
    let hasMore = true;

    // Initialize on load
    window.addEventListener('DOMContentLoaded', () => {
      setupEventListeners();
      loadTokens();
    });

    function setupEventListeners() {
      // Network selector dropdown
      document.getElementById('networkSelector').addEventListener('click', toggleNetworkDropdown);
      
      // Time filter tabs
      document.querySelectorAll('.time-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.time-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentTime = tab.textContent.toLowerCase().replace('all', 'max');
          reloadTokens();
        });
      });
      
      // Network items in dropdown
      document.querySelectorAll('.network-item').forEach(item => {
        item.addEventListener('click', () => {
          const networkName = item.querySelector('span').textContent;
          document.getElementById('networkSelector').querySelector('span').textContent = networkName;
          currentChain = chains.find(c => c.name === networkName)?.id || 'all';
          toggleNetworkDropdown();
          reloadTokens();
        });
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('#networkSelector') && !e.target.closest('#networkDropdown')) {
          document.getElementById('networkDropdown').classList.remove('active');
        }
      });
    }

    function toggleNetworkDropdown() {
      document.getElementById('networkDropdown').classList.toggle('active');
    }

    // Load tokens from APIs
    async function loadTokens() {
      if (isLoading) return;
      
      isLoading = true;
      document.getElementById('loadingIndicator').textContent = 'Loading tokens...';
      
      try {
        // In a real app, you would fetch from actual APIs here
        // For now we'll use the sample data
        allTokens = sampleTokens;
        
        renderedCount = 0;
        document.getElementById('tokenList').innerHTML = '';
        renderTokens();
        
      } catch (error) {
        console.error('Error loading tokens:', error);
        showError('Error loading tokens. Pull down to refresh.');
      } finally {
        isLoading = false;
      }
    }

    function reloadTokens() {
      renderedCount = 0;
      document.getElementById('tokenList').innerHTML = '';
      renderTokens();
    }

    function renderTokens() {
      const filteredTokens = allTokens.filter(token => 
        currentChain === 'all' || token.chain === currentChain
      );
      
      const tokensToRender = filteredTokens.slice(renderedCount, renderedCount + PAGE_SIZE);
      
      if (tokensToRender.length === 0) {
        document.getElementById('loadingIndicator').textContent = renderedCount === 0 
          ? 'No tokens found' 
          : 'No more tokens to load';
        hasMore = false;
        return;
      }
      
      const list = document.getElementById('tokenList');
      
      tokensToRender.forEach(token => {
        const changePercent = token.change24h.toFixed(2);
        const changeClass = token.change24h >= 0 ? 'price-up' : 'price-down';
        const volume = formatCurrency(token.volume);
        const price = formatCurrency(token.price, 6);
        
        const tokenElement = document.createElement('div');
        tokenElement.className = 'token-row';
        tokenElement.onclick = () => openTokenModal(token);
        tokenElement.innerHTML = `
          <div class="token-info">
            <img src="${chains.find(c => c.id === token.chain)?.logo || 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik0xMiAyQTEwIDEwIDAgMDAyIDEyYzAgMS42LjQgMy4xIDEuMSA0LjRMMy4xIDE4LjVDMS4zIDE2LjUgMCAxMy44IDAgMTFBMTEgMTEgMCAwMTExIDBjMi44IDAgNS4zIDEuMyA3IDEuMUwxNi40IDMuMUMxNS4xIDIuNCAxMy42IDIgMTIgMnptMCAyYTggOCAwIDAxOCA4YzAgLjcgMCAxLjQtLjIgMkg0LjJjLS4xLS42LS4yLTEuMy0uMi0yYTggOCAwIDAxOC04em0xIDguNXYtMy41aDJ2My41aDIuNWwtMy41IDMuNS0zLjUtMy41SDN2LTJoMy41VjcuNUg4djMuNUg1LjVMMyA4bDMuNS0zLjVINHYySDYuNVY3LjVIMTB2My41eiIvPjwvc3ZnPg=='}" 
                 class="token-icon" 
                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik0xMiAyQTEwIDEwIDAgMDAyIDEyYzAgMS42LjQgMy4xIDEuMSA0LjRMMy4xIDE4LjVDMS4zIDE2LjUgMCAxMy44IDAgMTFBMTEgMTEgMCAwMTExIDBjMi44IDAgNS4zIDEuMyA3IDEuMUwxNi40IDMuMUMxNS4xIDIuNCAxMy42IDIgMTIgMnptMCAyYTggOCAwIDAxOCA4YzAgLjcgMCAxLjQtLjIgMkg0LjJjLS4xLS42LS4yLTEuMy0uMi0yYTggOCAwIDAxOC04em0xIDguNXYtMy41aDJ2My41aDIuNWwtMy41IDMuNS0zLjUtMy41SDN2LTJoMy41VjcuNUg4djMuNUg1LjVMMyA4bDMuNS0zLjVINHYySDYuNVY3LjVIMTB2My41eiIvPjwvc3ZnPg=='"/>
            <div class="min-w-0">
              <p class="font-medium truncate">${token.name}</p>
              <p class="text-xs text-gray-400 truncate">${chains.find(c => c.id === token.chain)?.name || 'Unknown'}</p>
            </div>
          </div>
          <div class="text-right ${changeClass} font-medium">${price}</div>
          <div class="text-right pr-4">
            <div class="text-sm">${volume}</div>
            <div class="text-xs ${changeClass}">${changePercent}%</div>
          </div>`;
        list.appendChild(tokenElement);
      });
      
      renderedCount += tokensToRender.length;
      hasMore = renderedCount < filteredTokens.length;
      
      document.getElementById('loadingIndicator').textContent = hasMore 
        ? 'Scroll to load more' 
        : 'All tokens loaded';
    }

    // Open token details modal
    function openTokenModal(token) {
      const chainName = chains.find(c => c.id === token.chain)?.name || 'Unknown';
      
      document.getElementById('modalName').textContent = token.name;
      document.getElementById('modalChain').textContent = `${token.symbol} • ${chainName}`;
      document.getElementById('modalPrice').textContent = `${formatCurrency(token.price)} €`;
      
      const changeElement = document.getElementById('modalChange');
      changeElement.textContent = `${token.change24h >= 0 ? '+' : ''}${token.change24h.toFixed(2)}%`;
      changeElement.className = token.change24h >= 0 ? 'text-sm price-up' : 'text-sm price-down';
      
      // Set additional token details if available
      if (token.about) {
        document.querySelector('#tokenModal .about-text').textContent = token.about;
      }
      if (token.warning) {
        document.querySelector('#tokenModal .warning-text').textContent = token.warning;
      }
      if (token.marketCap) {
        document.querySelector('#tokenModal .market-cap').textContent = formatCurrency(token.marketCap, 2) + ' €';
      }
      if (token.circulatingSupply) {
        document.querySelector('#tokenModal .circulating-supply').textContent = formatCurrency(token.circulatingSupply, 2) + ' ' + token.symbol;
      }
      if (token.totalSupply) {
        document.querySelector('#tokenModal .total-supply').textContent = formatCurrency(token.totalSupply, 2) + ' ' + token.symbol;
      }
      if (token.contract) {
        document.querySelector('#tokenModal .contract-address span').textContent = token.contract;
      }
      
      toggleModal('tokenModal');
    }

    // Format currency
    function formatCurrency(value, maxDecimals = 2) {
      if (value >= 1000000000) {
        return `$${(value / 1000000000).toFixed(maxDecimals)}B`;
      }
      if (value >= 1000000) {
        return `$${(value / 1000000).toFixed(maxDecimals)}M`;
      }
      if (value >= 1000) {
        return `$${(value / 1000).toFixed(maxDecimals)}K`;
      }
      return `$${value.toFixed(maxDecimals)}`;
    }

    // Show error message
    function showError(message) {
      const list = document.getElementById('tokenList');
      list.innerHTML = `
        <div class="p-4 text-center text-red-400">
          ${message}
        </div>
      `;
      document.getElementById('loadingIndicator').textContent = '';
    }

    // Toggle modal visibility
    function toggleModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal.style.display === 'flex') {
        modal.style.display = 'none';
        document.body.style.overflow = '';
      } else {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
    }

    // Infinite scroll
    window.addEventListener('scroll', () => {
      const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
      
      if (scrollTop + clientHeight >= scrollHeight - 200 && hasMore && !isLoading) {
        renderTokens();
      }
    });

    // Pull-to-refresh
    let startY = 0;
    let touchStart = false;
    
    document.addEventListener('touchstart', (e) => {
      if (window.scrollY === 0) {
        startY = e.touches[0].clientY;
        touchStart = true;
      }
    }, { passive: true });
    
    document.addEventListener('touchmove', (e) => {
      if (!touchStart) return;
      
      const y = e.touches[0].clientY;
      const pullDistance = y - startY;
      
      if (pullDistance > 50 && window.scrollY === 0) {
        touchStart = false;
        loadTokens();
      }
    }, { passive: true });
    
    document.addEventListener('touchend', () => {
      touchStart = false;
    }, { passive: true });
  </script>
</body>
</html>
