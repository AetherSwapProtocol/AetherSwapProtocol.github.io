<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Popular Tokens – AetherSwap</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #0f0f1b; color: #fff; font-family: 'Inter', sans-serif; padding-bottom: 100px; }
    .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(12px); border:1px solid rgba(255,255,255,0.1); border-radius:16px; }
    .token-row:hover { background: rgba(255,255,255,0.05); cursor: pointer; }
    .scrollbar-hide::-webkit-scrollbar { display:none; }
    .scrollbar-hide { -ms-overflow-style:none; scrollbar-width:none; }
  </style>
</head>
<body class="p-4">

  <!-- Chains selection bar -->
  <div id="chainBar" class="flex overflow-x-auto scrollbar-hide mb-4 space-x-2">
    <button class="glass px-4 py-2 rounded-full text-sm" onclick="selectChain('all')">All Chains</button>
  </div>

  <!-- Time filters -->
  <div class="flex justify-around mb-4">
    <button class="glass px-3 py-1 text-xs" onclick="setTime('1h')">1h</button>
    <button class="glass px-3 py-1 text-xs" onclick="setTime('24h')">24h</button>
    <button class="glass px-3 py-1 text-xs" onclick="setTime('7d')">7d</button>
  </div>

  <!-- Token list -->
  <div id="tokenList" class="space-y-3"></div>

  <!-- Token detail popup -->
  <div id="tokenPopup" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
    <div class="glass p-6 w-11/12 max-w-md relative">
      <button onclick="closeToken()" class="absolute top-3 right-3 text-white text-xl">✕</button>
      <div id="popupIcon" class="mx-auto w-12 h-12 rounded-full mb-3"></div>
      <div class="text-lg font-semibold mb-2" id="popupName"></div>
      <div class="text-sm mb-2">Chain: <span id="popupChain"></span></div>
      <div class="text-sm mb-2">Contract:</div>
      <div class="bg-gray-800 p-2 rounded flex justify-between items-center mb-4">
        <code id="popupAddress" class="text-xs truncate"></code>
        <button onclick="copyAddress()" class="text-xs text-blue-400">Copy</button>
      </div>
      <a href="#" id="swapLink" class="block bg-purple-600 text-center text-white py-2 rounded-full">Swap Token</a>
    </div>
  </div>

<script>
  let currentChain = 'all', currentTime = '1h';

  async function loadChains() {
    const chains = ['Ethereum','Solana','Bnb-chain','Polygon','Arbitrum'];
    let bar = document.getElementById('chainBar');
    chains.forEach(c => {
      const btn = document.createElement('button');
      btn.className = 'glass px-4 py-2 rounded-full text-sm';
      btn.textContent = c;
      btn.onclick = () => selectChain(c.toLowerCase());
      bar.appendChild(btn);
    });
  }

  async function loadTokens() {
    const [boosts, newPoolsResp] = await Promise.all([
      fetch('https://api.dexscreener.com/token-boosts/latest/v1').then(r => r.json()),
      fetch('https://api.geckoterminal.com/api/v2/networks/new_pools').then(r => r.json())
    ]);
    const newPools = newPoolsResp.data ?? [];

    const items = [...boosts, ...newPools.map(p => ({
      chainId: p.network,
      tokenAddress: p.base_token.address,
      header: p.base_token.symbol,
      icon: p.base_token.logo,
      priceChange: p.price_change_24h,
      volumeUsd: p.volume_24h_usd
    }))];

    const unique = {};
    items.forEach(i => {
      const key = i.chainId+"_"+i.tokenAddress;
      if (!unique[key]) unique[key] = i;
    });

    const filtered = Object.values(unique)
      .filter(i => currentChain === 'all' || i.chainId.toLowerCase() === currentChain)
      .sort((a,b) => (b.volumeUsd||0) - (a.volumeUsd||0));

    const list = document.getElementById('tokenList');
    list.innerHTML = '';
    filtered.forEach(item => {
      const el = document.createElement('div');
      el.className = 'glass p-4 flex items-center justify-between token-row';
      el.onclick = () => openTokenDetail(item);
      const change = (item.priceChange||0)*100;
      el.innerHTML = `
        <div class="flex items-center space-x-3">
          <img src="${item.icon}" class="w-8 h-8 rounded-full" alt="${item.header}">
          <div><div class="font-semibold">${item.header}</div><div class="text-xs text-gray-400">${item.chainId}</div></div>
        </div>
        <div class="text-right">
          <div class="text-sm font-bold ${change>=0?'text-green-400':'text-red-400'}">${change.toFixed(2)}%</div>
          <div class="text-xs text-gray-400">${(item.volumeUsd||0).toLocaleString()} USD</div>
        </div>`;
      list.appendChild(el);
    });
  }

  function selectChain(chain) {
    currentChain = chain;
    loadTokens();
  }

  function setTime(t) {
    currentTime = t;
  }

  function openTokenDetail(item) {
    document.getElementById('popupIcon').innerHTML = `<img src="${item.icon}" class="w-12 h-12 rounded-full mx-auto" alt="${item.header}" />`;
    document.getElementById('popupName').textContent = item.header;
    document.getElementById('popupChain').textContent = item.chainId;
    document.getElementById('popupAddress').textContent = item.tokenAddress;
    document.getElementById('swapLink').href = `/swap.html?chain=${item.chainId}&address=${item.tokenAddress}`;
    document.getElementById('tokenPopup').classList.remove('hidden');
  }

  function closeToken() {
    document.getElementById('tokenPopup').classList.add('hidden');
  }

  function copyAddress() {
    const addr = document.getElementById('popupAddress').innerText;
    navigator.clipboard.writeText(addr).then(() => alert('Copied'));
  }

  window.addEventListener('load', async () => {
    await loadChains();
    await loadTokens();
  });
</script>

</body>
</html>