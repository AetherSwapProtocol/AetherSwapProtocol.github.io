<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AetherSwap | Ultimate Social DEX</title>
<!-- CSS Libraries -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Web3 Libraries -->
<script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.7.8/dist/umd/index.min.js"></script>

<style>
  :root {
    /* Variables existantes */
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --primary-light: #818cf8;
    --dark: #1e293b;
    --light: #f8fafc;
    --gray: #64748b;
    --light-gray: #e2e8f0;
    --success: #10b981;
    --danger: #ef4444;
    --warning: #f59e0b;
    --white: #ffffff;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
    --radius: 0.5rem;
    --breakpoint-md: 768px;

    /* Nouveaux ajouts */
    --chat-bg: #f9fafb;
    --chat-primary: #6366f1;
    --community-bg: #f3f4f6;
  }

  /* Structure existante améliorée */
  .app-container {
    display: grid;
    grid-template-areas:
      "header header"
      "main chat"
      "footer footer";
    grid-template-columns: 1fr 300px;
    min-height: 100vh;
  }

  header {
    grid-area: header;
    /* Styles existants */
  }

  main {
    grid-area: main;
    /* Styles existants + ajustements */
    padding: 2rem;
  }

  .community-panel {
    grid-area: chat;
    background: var(--community-bg);
    border-left: 1px solid var(--light-gray);
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
  }

  footer {
    grid-area: footer;
    /* Styles existants */
  }

  /* Nouveaux composants */
  .chat-container {
    flex-grow: 1;
    background: var(--chat-bg);
    border-radius: var(--radius);
    padding: 1rem;
    display: flex;
    flex-direction: column;
  }

  .chat-messages {
    flex-grow: 1;
    overflow-y: auto;
    margin-bottom: 1rem;
  }

  .chat-input {
    display: flex;
    gap: 0.5rem;
  }

  .chat-input input {
    flex-grow: 1;
    padding: 0.75rem;
    border: 1px solid var(--light-gray);
    border-radius: var(--radius);
  }

  .chat-input button {
    background: var(--primary);
    color: white;
    border: none;
    border-radius: var(--radius);
    padding: 0 1rem;
    cursor: pointer;
  }

  /* Menu utilisateur amélioré */
  .user-menu {
    position: relative;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
  }

  .user-dropdown {
    /* Styles existants améliorés */
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .app-container {
      grid-template-areas:
        "header"
        "main"
        "chat"
        "footer";
      grid-template-columns: 1fr;
    }
    
    .community-panel {
      border-left: none;
      border-top: 1px solid var(--light-gray);
    }
  }
</style>
</head>
<body class="app-container">

<!-- Header existant AVEC les améliorations -->
<header class="header">
  <div class="logo-container">
    <img src="logo.svg" alt="AetherSwap" class="logo">
    <nav class="main-nav">
      <a href="#swap">Swap</a>
      <a href="#tokens">Tokens</a>
      <a href="#community">Community</a>
    </nav>
  </div>
  
  <div class="header-controls">
    <select id="languageSelector" class="lang-selector">
      <option value="en">English</option>
      <option value="fr">Français</option>
      <option value="es">Español</option>
      <option value="zh">中文</option>
      <option value="de">Deutsch</option>
    </select>
    
    <div class="user-menu" id="userMenu">
      <img src="default-avatar.png" id="userAvatar" class="user-avatar">
      <span id="userAddress"></span>
      <i class="fas fa-chevron-down"></i>
      
      <div class="user-dropdown">
        <a href="#profile"><i class="fas fa-user"></i> Profile</a>
        <a href="#settings"><i class="fas fa-cog"></i> Settings</a>
        <button id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
      </div>
    </div>
    
    <button id="connectWalletBtn" class="connect-btn">Connect Wallet</button>
  </div>
</header>

<!-- Main content - TOUTES les fonctionnalités existantes + nouvelles -->
<main>
  <section id="swap" class="swap-section">
    <!-- Interface de swap existante AVEC les améliorations -->
    <div class="advanced-swap-container">
      <!-- [Votre code de swap amélioré] -->
    </div>
  </section>
  
  <section id="tokens" class="tokens-section">
    <!-- Ticker et top tokens existants AVEC améliorations -->
    <div class="crypto-ticker" id="cryptoTicker"></div>
    
    <div class="tokens-grid" id="topTokensGrid">
      <!-- Rempli dynamiquement -->
    </div>
  </section>
</main>

<!-- Nouveau panneau communautaire -->
<aside class="community-panel">
  <div class="community-chat">
    <h3><i class="fas fa-comments"></i> Community Chat</h3>
    
    <div class="chat-container">
      <div class="chat-messages" id="chatMessages">
        <!-- Messages chargés dynamiquement -->
        <div class="system-message">Welcome to AetherSwap community chat! Sign in to participate.</div>
      </div>
      
      <div class="chat-input">
        <input type="text" id="chatInput" placeholder="Your message..." disabled>
        <button id="sendMessageBtn" disabled><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>
  </div>
  
  <div class="live-events">
    <h4><i class="fas fa-bullhorn"></i> Live Events</h4>
    <ul id="liveEvents">
      <li>New token listing: ATH - 15:30 UTC</li>
      <li>AMA with CEO today at 18:00 UTC</li>
    </ul>
  </div>
</aside>

<footer>
  <!-- Footer existant -->
</footer>

<script>
  // TOUT le code JavaScript précédent AVEC les améliorations
  
  // Nouvelle fonctionnalité: Chat communautaire
  const chatMessages = document.getElementById('chatMessages');
  const chatInput = document.getElementById('chatInput');
  const sendMessageBtn = document.getElementById('sendMessageBtn');
  
  // Gestion de l'authentification pour le chat
  function setupChatAuthentication(user) {
    if(user) {
      chatInput.disabled = false;
      sendMessageBtn.disabled = false;
      chatInput.placeholder = `Message as ${user.username || 'Anon'}`;
    } else {
      chatInput.disabled = true;
      sendMessageBtn.disabled = true;
    }
  }
  
  // Envoi de message
  sendMessageBtn.addEventListener('click', async () => {
    const message = chatInput.value.trim();
    if(!message) return;
    
    try {
      // Envoyer le message au backend
      const response = await fetch('/api/chat/send', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${user.authToken}`
        },
        body: JSON.stringify({ message })
      });
      
      if(response.ok) {
        chatInput.value = '';
        // Ajouter le message localement
        addMessageToChat({
          user: user.username,
          message,
          timestamp: new Date().toISOString()
        });
      }
    } catch(error) {
      console.error('Chat error:', error);
    }
  });
  
  // Fonction pour ajouter un message au chat
  function addMessageToChat(msg) {
    const msgElement = document.createElement('div');
    msgElement.className = 'chat-message';
    msgElement.innerHTML = `
      <strong>${msg.user}</strong>: ${msg.message}
      <small>${new Date(msg.timestamp).toLocaleTimeString()}</small>
    `;
    chatMessages.appendChild(msgElement);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
  
  // Connexion WebSocket pour le chat en temps réel
  function connectChatWebSocket() {
    const socket = new WebSocket('wss://api.aetherswap.com/chat');
    
    socket.onmessage = (event) => {
      const message = JSON.parse(event.data);
      addMessageToChat(message);
    };
    
    socket.onclose = () => {
      setTimeout(connectChatWebSocket, 5000);
    };
  }
  
  // Initialisation
  document.addEventListener('DOMContentLoaded', () => {
    // Initialiser toutes les fonctionnalités existantes
    initSwapInterface();
    initWalletConnection();
    loadTickerData();
    loadTopTokens();
    
    // Initialiser les nouvelles fonctionnalités
    connectChatWebSocket();
    setupChatAuthentication(currentUser);
  });
</script>
</body>
</html>