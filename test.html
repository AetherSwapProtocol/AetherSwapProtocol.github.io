<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AetherSwap | PURPE Swap</title>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.73.0/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@jup-ag/core@3.2.0/dist/index.iife.min.js"></script>
  <style>
    :root {
      --primary: #8A2BE2;
      --secondary: #9932CC;
      --dark: #121212;
      --light: #FFFFFF;
      --gray: #1E1E1E;
      --success: #14F195;
      --error: #FF3333;
    }
    
    /* [Previous CSS remains identical] */
  </style>
</head>
<body>
  <!-- [Previous HTML structure remains identical] -->

  <script>
    // Configuration Jupiter + Fee Account
    const JUPITER_CONFIG = {
      feeBps: 50, // 0.5% fee
      feeAccount: new solanaWeb3.PublicKey('VOTRE_ADRESSE_DE_FEE'), // ← À REMPLACER
      referralAccount: new solanaWeb3.PublicKey('VOTRE_ADRESSE_REFERRAL') // ← Optionnel
    };

    // Initialisation Jupiter
    let jupiter;
    let wallet;
    let connection = new solanaWeb3.Connection('https://api.mainnet-beta.solana.com');

    async function initJupiter() {
      jupiter = await Jupiter.init({
        connection,
        cluster: 'mainnet-beta',
        user: wallet?.publicKey || null,
      });
    }

    // Gestion Wallet
    async function connectWallet() {
      try {
        if (window.solana?.isPhantom) {
          wallet = window.solana;
          await wallet.connect();
          document.querySelector('.btn-secondary').textContent = 'Connected';
          await initJupiter();
        } else {
          alert('Phantom Wallet required');
        }
      } catch (error) {
        console.error("Wallet error:", error);
      }
    }

    // Swap via Jupiter avec frais
    async function executeSwap() {
      if (!wallet) return connectWallet();
      
      const fromToken = 'So11111111111111111111111111111111111111112'; // SOL
      const toToken = 'ADRESSE_DU_TOKEN_PURPE'; // ← À REMPLACER
      const amount = parseFloat(document.querySelector('.token-amount').value) * 1e9; // SOL decimals

      try {
        // 1. Get quote with fees
        const quote = await jupiter.computeRoutes({
          inputMint: new solanaWeb3.PublicKey(fromToken),
          outputMint: new solanaWeb3.PublicKey(toToken),
          amount,
          slippageBps: 50, // 0.5% slippage
          feeBps: JUPITER_CONFIG.feeBps,
          feeAccount: JUPITER_CONFIG.feeAccount
        });

        // 2. Prepare swap transaction
        const { swapTransaction } = await jupiter.exchange({
          route: quote.routes[0]
        });

        // 3. Execute swap
        const signedTx = await wallet.signTransaction(swapTransaction);
        const txid = await connection.sendRawTransaction(signedTx.serialize());
        
        console.log("Swap success! TX:", txid);
        alert(`Swap réussi! Vous avez gagné ${amount * 0.005} en frais`);

      } catch (error) {
        console.error("Swap failed:", error);
        alert("Erreur: " + error.message);
      }
    }

    // Event Listeners
    document.querySelector('.btn-secondary').addEventListener('click', connectWallet);
    document.querySelector('.btn-primary').addEventListener('click', executeSwap);

    // Initialisation
    window.addEventListener('load', initJupiter);
  </script>
</body>
</html>