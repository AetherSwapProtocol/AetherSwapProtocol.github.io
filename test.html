<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AetherSwap PRO - Modern Token Swap</title>
  <style>
    :root {
      --primary: #6e45e2;
      --primary-hover: #5934ba;
      --bg: #0f0f0f;
      --surface: #1a1a2f;
      --text: #eee;
      --text-muted: #aaa;
      --danger: #ff4d4d;
      --success: #4dffb5;
      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --shadow: 0 8px 24px rgba(0,0,0,0.7);
      --transition: 0.2s ease;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 24px;
      min-height: 100vh;
    }

    .swap-container {
      max-width: 480px;
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 24px;
      box-shadow: var(--shadow);
      user-select: none;
    }

    /* Network status */
    .network-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 16px;
    }
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
    }

    /* Token input container */
    .token-input {
      background: rgba(255,255,255,0.05);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 12px;
      transition: all var(--transition);
      display: flex;
      flex-direction: column;
    }

    .token-input.active {
      border: 1px solid var(--primary);
      box-shadow: 0 0 0 1px var(--primary);
    }

    /* Token selector with icon */
    .token-selector {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      user-select: none;
    }

    .token-selector:hover {
      opacity: 0.9;
    }

    .token-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #fff;
      object-fit: contain;
      flex-shrink: 0;
    }

    .token-symbol {
      font-weight: 700;
      font-size: 1.2rem;
    }

    .token-balance {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-left: auto;
      user-select: text;
      font-variant-numeric: tabular-nums;
    }

    /* Amount input */
    .amount-row {
      margin-top: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .amount-input {
      width: 70%;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 1.8rem;
      text-align: left;
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }

    .amount-input:focus {
      outline: none;
    }

    .usd-value {
      width: 30%;
      text-align: right;
      color: var(--text-muted);
      font-size: 0.9rem;
      font-variant-numeric: tabular-nums;
      user-select: none;
    }

    /* Swap arrow button between tokens */
    .swap-arrow {
      background: var(--surface);
      border: 2px solid var(--bg);
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 12px auto;
      cursor: pointer;
      z-index: 2;
      position: relative;
      transition: all var(--transition);
      color: var(--primary);
      font-size: 1.6rem;
      user-select: none;
    }

    .swap-arrow:hover {
      transform: rotate(180deg);
      background: var(--primary);
      color: white;
    }

    /* Swap button */
    .swap-button {
      width: 100%;
      background: var(--primary);
      color: white;
      border: none;
      padding: 16px;
      border-radius: var(--radius-md);
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      margin-top: 16px;
      transition: all var(--transition);
      user-select: none;
    }

    .swap-button:hover:not(:disabled) {
      background: var(--primary-hover);
      transform: translateY(-2px);
    }

    .swap-button:disabled {
      background: #3a3a5a;
      cursor: not-allowed;
      transform: none;
    }

    /* Swap details */
    .swap-details {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
      font-size: 0.9rem;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .price-impact {
      color: var(--success);
      user-select: none;
    }

    .price-impact.high {
      color: var(--danger);
    }

    /* Token modal */
    .token-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
      user-select: none;
    }
    .token-modal.active {
      opacity: 1;
      pointer-events: all;
    }

    .token-modal-content {
      background: var(--surface);
      border-radius: var(--radius-lg);
      width: 90%;
      max-width: 440px;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      user-select: text;
    }

    .token-search {
      padding: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .token-search input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255,255,255,0.05);
      border: none;
      border-radius: var(--radius-md);
      color: var(--text);
      font-size: 1rem;
    }

    .token-list {
      flex-grow: 1;
      overflow-y: auto;
    }

    .token-item {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: background-color 0.15s ease;
    }

    .token-item:hover {
      background: rgba(110, 69, 226, 0.3);
    }

    .token-item-info {
      flex: 1;
      overflow: hidden;
    }

    .token-item-symbol {
      font-weight: 700;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .token-item-name {
      font-size: 0.8rem;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .token-item-balance {
      font-variant-numeric: tabular-nums;
      font-weight: 600;
      user-select: none;
      min-width: 70px;
      text-align: right;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .swap-container {
        padding: 16px;
      }

      .amount-input {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="swap-container" role="main" aria-label="Token Swap Interface">
    <div class="network-status" aria-live="polite" aria-atomic="true">
      <div class="status-indicator" aria-hidden="true"></div>
      <span>AetherSwap</span>
      <span aria-hidden="true">•</span>
      <span>Fast: 0.0005 SOL</span>
    </div>

    <!-- From Token -->
    <div class="token-input active" id="fromTokenInput">
      <div class="token-selector" id="fromTokenSelector" role="button" tabindex="0" aria-label="Select from token">
        <img src="" alt="" class="token-logo" id="fromTokenLogo" aria-hidden="true" />
        <div class="token-symbol" id="fromTokenSymbol">Select Token</div>
        <div class="token-balance" id="fromTokenBalance" aria-live="polite" aria-atomic="true">Balance: 0.0</div>
      </div>
      <div class="amount-row">
        <input type="number" step="any" min="0" class="amount-input" id="fromAmount" placeholder="0.0" aria-label="From amount" autocomplete="off" />
        <div class="usd-value" id="fromAmountUSD">≈ $0.00</div>
      </div>
    </div>

    <!-- Swap arrow -->
    <button class="swap-arrow" id="switchTokens" aria-label="Switch tokens" title="Switch tokens">⇅</button>

    <!-- To Token -->
    <div class="token-input" id="toTokenInput">
      <div class="token-selector" id="toTokenSelector" role="button" tabindex="0" aria-label="Select to token">
        <img src="" alt="" class="token-logo" id="toTokenLogo" aria-hidden="true" />
        <div class="token-symbol" id="toTokenSymbol">Select Token</div>
        <div class="token-balance" id="toTokenBalance" aria-live="polite" aria-atomic="true">Balance: 0.0</div>
      </div>
      <div class="amount-row">
        <input type="number" step="any" min="0" class="amount-input" id="toAmount" placeholder="0.0" aria-label="To amount" autocomplete="off" readonly />
        <div class="usd-value" id="toAmountUSD">≈ $0.00</div>
      </div>
    </div>

    <!-- Swap details -->
    <div class="swap-details" aria-live="polite" aria-atomic="true">
      <div class="detail-row">
        <span>Exchange Rate</span>
        <span id="exchangeRate">-</span>
      </div>
      <div class="detail-row">
        <span>Price Impact</span>
        <span class="price-impact" id="priceImpact">-</span>
      </div>
      <div class="detail-row">
        <span>Network Fee</span>
        <span id="networkFee">-</span>
      </div>
    </div>

    <!-- Swap button -->
    <button class="swap-button" id="swapButton" disabled>Connect Wallet</button>
  </div>

  <!-- Token selection modal -->
  <div class="token-modal" id="tokenModal" role="dialog" aria-modal="true" aria-labelledby="tokenModalTitle" tabindex="-1">
    <div class="token-modal-content">
      <div class="token-search">
        <input type="search" id="tokenSearch" placeholder="Search token name or address..." aria-label="Search tokens" autocomplete="off" />
      </div>
      <div class="token-list" id="tokenList" role="list" tabindex="0">
        <!-- Tokens inserted dynamically -->
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.70.1/lib/index.iife.min.js"></script>
  <script>
    (() => {
      const config = {
        defaultSlippage: 0.5, // percent
        jupiterTokenListAPI: 'https://lite-api.jup.ag/tokens/v2/list',
        jupiterQuoteAPI: 'https://quote-api.jup.ag/v1/quote',
        jupiterSwapAPI: 'https://quote-api.jup.ag/v1/swap',
        connection: new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta')),
      };

      // State object
      const state = {
        tokens: [],
        fromToken: null,
        toToken: null,
        fromAmount: '',
        toAmount: '',
        quote: null,
        wallet: null,
        balances: {},
        selectingFor: null, // 'from' or 'to'
      };

      // Cached DOM elements
      const elements = {
        fromTokenSelector: document.getElementById('fromTokenSelector'),
        toTokenSelector: document.getElementById('toTokenSelector'),
        fromTokenLogo: document.getElementById('fromTokenLogo'),
        toTokenLogo: document.getElementById('toTokenLogo'),
        fromTokenSymbol: document.getElementById('fromTokenSymbol'),
        toTokenSymbol: document.getElementById('toTokenSymbol'),
        fromTokenBalance: document.getElementById('fromTokenBalance'),
        toTokenBalance: document.getElementById('toTokenBalance'),
        fromAmount: document.getElementById('fromAmount'),
        toAmount: document.getElementById('toAmount'),
        fromAmountUSD: document.getElementById('fromAmountUSD'),
        toAmountUSD: document.getElementById('toAmountUSD'),
        switchTokens: document.getElementById('switchTokens'),
        swapButton: document.getElementById('swapButton'),
        tokenModal: document.getElementById('tokenModal'),
        tokenSearch: document.getElementById('tokenSearch'),
        tokenList: document.getElementById('tokenList'),
        exchangeRate: document.getElementById('exchangeRate'),
        priceImpact: document.getElementById('priceImpact'),
        networkFee: document.getElementById('networkFee'),
      };

      // --- UTILITIES ---
      function debounce(fn, delay = 300) {
        let timeout;
        return (...args) => {
          clearTimeout(timeout);
          timeout = setTimeout(() => fn(...args), delay);
        };
      }

      // Format big number to readable with fixed decimals
      function formatAmount(amount, decimals = 6) {
        return Number(amount).toLocaleString(undefined, {
          minimumFractionDigits: 0,
          maximumFractionDigits: decimals,
        });
      }

      // --- TOKEN MANAGEMENT ---

      async function loadTokenList() {
        try {
          const res = await fetch(config.jupiterTokenListAPI);
          const json = await res.json();
          // The response structure: { data: { tokens: [...] } }
          const tokens = json.data.tokens;

          // Filter for mainnet only (chainId=101)
          state.tokens = tokens.filter(t => t.chainId === 101);

          // Sort tokens: ones with logo first, then alphabetical
          state.tokens.sort((a,b) => {
            if (a.logoURI && !b.logoURI) return -1;
            if (!a.logoURI && b.logoURI) return 1;
            return a.symbol.localeCompare(b.symbol);
          });

          // Optional: preselect some default tokens
          state.fromToken = state.tokens.find(t => t.symbol === 'SOL') || state.tokens[0];
          state.toToken = state.tokens.find(t => t.symbol === 'USDC') || state.tokens[1];

          updateTokenUI('from');
          updateTokenUI('to');

          updateBalances();
          updateUI();
        } catch (e) {
          console.error('Failed to load token list', e);
        }
      }

      // Render token list in modal
      function renderTokenList(tokens) {
        elements.tokenList.innerHTML = '';

        if (tokens.length === 0) {
          elements.tokenList.innerHTML = `<div class="token-item" role="listitem">No tokens found</div>`;
          return;
        }

        tokens.forEach(token => {
          const tokenDiv = document.createElement('div');
          tokenDiv.className = 'token-item';
          tokenDiv.setAttribute('role', 'listitem');
          tokenDiv.tabIndex = 0;
          tokenDiv.innerHTML = `
            <img src="${token.logoURI || ''}" alt="" class="token-logo" loading="lazy" onerror="this.style.display='none'">
            <div class="token-item-info">
              <div class="token-item-symbol">${token.symbol}</div>
              <div class="token-item-name">${token.name}</div>
            </div>
            <div class="token-item-balance">${formatAmount(state.balances[token.address] || 0)}</div>
          `;
          tokenDiv.addEventListener('click', () => selectToken(token));
          tokenDiv.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              selectToken(token);
            }
          });
          elements.tokenList.appendChild(tokenDiv);
        });
      }

      // Open modal for token selection
      function openTokenModal(forToken) {
        state.selectingFor = forToken;
        elements.tokenSearch.value = '';
        renderTokenList(state.tokens);
        elements.tokenModal.classList.add('active');
        elements.tokenSearch.focus();
      }

      // Close modal
      function closeTokenModal() {
        elements.tokenModal.classList.remove('active');
        state.selectingFor = null;
      }

      // Select token from modal
      function selectToken(token) {
        if (state.selectingFor === 'from') {
          if (token.address === state.toToken?.address) {
            // Prevent same token on both sides
            alert('Please choose a different token than the "To" token.');
            return;
          }
          state.fromToken = token;
        } else if (state.selectingFor === 'to') {
          if (token.address === state.fromToken?.address) {
            alert('Please choose a different token than the "From" token.');
            return;
          }
          state.toToken = token;
        }
        updateTokenUI(state.selectingFor);
        closeTokenModal();
        updateQuote();
      }

      // Filter tokens on search input
      const onTokenSearch = debounce(() => {
        const term = elements.tokenSearch.value.trim().toLowerCase();
        if (term.length === 0) {
          renderTokenList(state.tokens);
          return;
        }
        const filtered = state.tokens.filter(t =>
          t.symbol.toLowerCase().includes(term) ||
          t.name.toLowerCase().includes(term) ||
          t.address.toLowerCase() === term
        );
        renderTokenList(filtered);
      }, 200);

      // Update token UI selector (logo, symbol, balance)
      function updateTokenUI(side) {
        const token = side === 'from' ? state.fromToken : state.toToken;
        if (!token) return;

        if (side === 'from') {
          elements.fromTokenLogo.src = token.logoURI || '';
          elements.fromTokenLogo.alt = token.name + ' logo';
          elements.fromTokenSymbol.textContent = token.symbol;
          elements.fromTokenBalance.textContent = `Balance: ${formatAmount(state.balances[token.address] || 0, 4)}`;
          elements.fromAmount.placeholder = `0.0`;
          elements.fromAmount.value = state.fromAmount || '';
          elements.fromAmount.removeAttribute('disabled');
        } else {
          elements.toTokenLogo.src = token.logoURI || '';
          elements.toTokenLogo.alt = token.name + ' logo';
          elements.toTokenSymbol.textContent = token.symbol;
          elements.toTokenBalance.textContent = `Balance: ${formatAmount(state.balances[token.address] || 0, 4)}`;
          elements.toAmount.value = state.toAmount || '';
          elements.toAmount.placeholder = `0.0`;
          elements.toAmount.setAttribute('disabled', 'disabled');
        }
      }

      // --- WALLET MANAGEMENT ---

      async function connectWallet() {
        if (!window.solana) {
          alert('Phantom wallet not detected! Please install Phantom.');
          return;
        }
        try {
          const resp = await window.solana.connect();
          state.wallet = resp.publicKey;
          elements.swapButton.textContent = 'Swap';
          elements.swapButton.disabled = false;
          updateBalances();
        } catch (err) {
          console.error('Wallet connection failed', err);
          elements.swapButton.textContent = 'Connect Wallet';
          elements.swapButton.disabled = false;
          alert('Failed to connect wallet');
        }
      }

      async function disconnectWallet() {
        if (window.solana && window.solana.isConnected) {
          await window.solana.disconnect();
          state.wallet = null;
          elements.swapButton.textContent = 'Connect Wallet';
          elements.swapButton.disabled = true;
          resetBalances();
          updateUI();
        }
      }

      function onWalletConnectChange(publicKey) {
        state.wallet = publicKey;
        if (publicKey) {
          elements.swapButton.textContent = 'Swap';
          elements.swapButton.disabled = false;
          updateBalances();
        } else {
          elements.swapButton.textContent = 'Connect Wallet';
          elements.swapButton.disabled = true;
          resetBalances();
          updateUI();
        }
      }

      // --- BALANCES ---

      async function updateBalances() {
        if (!state.wallet) return;

        // Always include SOL balance as well
        try {
          const solBalance = await config.connection.getBalance(state.wallet);
          state.balances['SOL'] = solBalance / 1e9; // lamports to SOL
        } catch (e) {
          console.error('Failed to fetch SOL balance', e);
          state.balances['SOL'] = 0;
        }

        // For tokens, use getTokenAccountsByOwner and parse balances
        const tokenAddresses = state.tokens.map(t => t.address);
        try {
          const tokenAccounts = await config.connection.getTokenAccountsByOwner(
            state.wallet,
            { programId: solanaWeb3.TOKEN_PROGRAM_ID }
          );

          // Reset all balances to zero first
          tokenAddresses.forEach(addr => state.balances[addr] = 0);

          for (const { pubkey, account } of tokenAccounts.value) {
            const parsed = solanaWeb3.AccountLayout.decode(account.data);
            const mint = new solanaWeb3.PublicKey(parsed.mint).toBase58();
            if (tokenAddresses.includes(mint)) {
              const amount = solanaWeb3.u64.fromBuffer(parsed.amount);
              const token = state.tokens.find(t => t.address === mint);
              const decimals = token?.decimals || 0;
              state.balances[mint] = Number(amount.toString()) / (10 ** decimals);
            }
          }
        } catch (e) {
          console.error('Failed to fetch token balances', e);
        }

        // Update UI
        updateTokenUI('from');
        updateTokenUI('to');
      }

      function resetBalances() {
        state.balances = {};
        updateTokenUI('from');
        updateTokenUI('to');
      }

      // --- QUOTE & SWAP ---

      let lastQuoteId = null;
      let lastQuoteTimestamp = 0;

      async function updateQuote() {
        if (!state.fromToken || !state.toToken) return;
        if (!state.fromAmount || Number(state.fromAmount) <= 0) {
          state.toAmount = '';
          elements.toAmount.value = '';
          updateSwapDetails(null);
          return;
        }

        // Avoid spamming API too much
        const now = Date.now();
        if (now - lastQuoteTimestamp < 1000) return;
        lastQuoteTimestamp = now;

        const fromMint = state.fromToken.address;
        const toMint = state.toToken.address;
        const amountRaw = Math.floor(Number(state.fromAmount) * 10 ** state.fromToken.decimals);

        // Build quote URL
        const url = `${config.jupiterQuoteAPI}?inputMint=${fromMint}&outputMint=${toMint}&amount=${amountRaw}&slippageBps=${config.defaultSlippage * 100}`;

        try {
          const res = await fetch(url);
          const json = await res.json();

          if (!json.data || !json.data[0]) {
            state.toAmount = '';
            elements.toAmount.value = '';
            updateSwapDetails(null);
            return;
          }

          const bestQuote = json.data[0];

          state.quote = bestQuote;

          // Calculate toAmount
          const toAmountRaw = bestQuote.outAmount;
          const toAmountDecimal = toAmountRaw / 10 ** state.toToken.decimals;

          state.toAmount = toAmountDecimal.toFixed(6);
          elements.toAmount.value = state.toAmount;

          updateSwapDetails(bestQuote);
          updateUSDValues();

        } catch (e) {
          console.error('Quote fetch error', e);
          state.toAmount = '';
          elements.toAmount.value = '';
          updateSwapDetails(null);
        }
      }

      // Update swap details UI
      function updateSwapDetails(quote) {
        if (!quote) {
          elements.exchangeRate.textContent = '-';
          elements.priceImpact.textContent = '-';
          elements.priceImpact.classList.remove('high');
          elements.networkFee.textContent = '-';
          return;
        }
        // Exchange rate: how many toTokens per fromToken?
        const rate = (quote.outAmount / 10 ** state.toToken.decimals) / (quote.inAmount / 10 ** state.fromToken.decimals);
        elements.exchangeRate.textContent = `1 ${state.fromToken.symbol} = ${rate.toFixed(6)} ${state.toToken.symbol}`;

        // Price impact in percent (example, might need adjustment)
        const priceImpactPct = quote.priceImpactPct || 0;
        elements.priceImpact.textContent = `${(priceImpactPct * 100).toFixed(2)}%`;
        if (priceImpactPct > 0.01) {
          elements.priceImpact.classList.add('high');
        } else {
          elements.priceImpact.classList.remove('high');
        }

        // Network fee in SOL
        const feeSol = quote.feeCost || 0;
        elements.networkFee.textContent = `${(feeSol / 1e9).toFixed(6)} SOL`;
      }

      // Convert token amounts to USD approx using a naive method (e.g. fixed price or no price)
      // Here for demo, we keep it simple and just show $0.00 (TODO: implement price fetching)
      function updateUSDValues() {
        // Could integrate price feed here for real USD estimation
        elements.fromAmountUSD.textContent = '≈ $0.00';
        elements.toAmountUSD.textContent = '≈ $0.00';
      }

      // --- EVENT LISTENERS ---

      elements.fromTokenSelector.addEventListener('click', () => openTokenModal('from'));
      elements.toTokenSelector.addEventListener('click', () => openTokenModal('to'));
      elements.switchTokens.addEventListener('click', () => {
        // Swap tokens & reset amounts
        const tmpToken = state.fromToken;
        state.fromToken = state.toToken;
        state.toToken = tmpToken;

        const tmpAmount = state.fromAmount;
        state.fromAmount = state.toAmount;
        state.toAmount = tmpAmount;

        updateTokenUI('from');
        updateTokenUI('to');
        updateQuote();
      });

      elements.fromAmount.addEventListener('input', e => {
        state.fromAmount = e.target.value;
        updateQuote();
      });

      elements.tokenSearch.addEventListener('input', onTokenSearch);

      elements.tokenModal.addEventListener('click', e => {
        if (e.target === elements.tokenModal) {
          closeTokenModal();
        }
      });

      // Swap button logic
      elements.swapButton.addEventListener('click', async () => {
        if (!state.wallet) {
          elements.swapButton.disabled = true;
          elements.swapButton.textContent = 'Connecting...';
          await connectWallet();
          elements.swapButton.disabled = false;
          return;
        }
        if (!state.quote) {
          alert('No valid quote. Please enter an amount and select tokens.');
          return;
        }
        // TODO: Implement swap transaction with Jupiter swap API
        alert(`Swap simulation:\nSwap ${state.fromAmount} ${state.fromToken.symbol} to approx ${state.toAmount} ${state.toToken.symbol}`);
      });

      // --- INIT ---

      // Phantom wallet event listeners
      if (window.solana && window.solana.isPhantom) {
        window.solana.on('connect', () => onWalletConnectChange(window.solana.publicKey));
        window.solana.on('disconnect', () => onWalletConnectChange(null));

        if (window.solana.isConnected) {
          state.wallet = window.solana.publicKey;
          elements.swapButton.textContent = 'Swap';
          elements.swapButton.disabled = false;
          updateBalances();
        } else {
          elements.swapButton.textContent = 'Connect Wallet';
          elements.swapButton.disabled = false;
        }
      } else {
        elements.swapButton.textContent = 'No Phantom Wallet';
        elements.swapButton.disabled = true;
      }

      loadTokenList();
    })();
  </script>
</body>
</html>
