<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aether-Core Pro | Web3 Mining Game</title>
  <style>
    :root {
      --primary: #00f0ff;
      --text: #e0f8ff;
      --dark: #050510;
      --error: #ff3860;
      --success: #00ff88;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--dark);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100dvh;
      overflow: hidden;
    }

    header {
      text-align: center;
      margin-bottom: 10px;
    }

    .username {
      font-size: 0.9rem;
      color: var(--success);
    }

    .stats {
      text-align: center;
      margin-bottom: 20px;
    }

    .stats div {
      margin: 8px 0;
    }

    button {
      background: var(--primary);
      color: black;
      border: none;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      margin: 5px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button svg {
      height: 20px;
      width: 20px;
      fill: black;
    }

    button:disabled {
      background: gray;
      cursor: not-allowed;
    }

    #log {
      font-size: 0.8rem;
      color: var(--error);
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Aether-Core Pro</h1>
    <div id="telegram-user" class="username">Connecté : Anonyme</div>
  </header>

  <div class="stats">
    <div><strong>Coins:</strong> <span id="coins">0</span></div>
    <div><strong>Énergie:</strong> <span id="energy">100</span> / <span id="max-energy">100</span></div>
    <div><strong>Puissance:</strong> <span id="power">1</span> × <span id="multiplier">1</span></div>
  </div>

  <button id="mine-btn">
    <svg viewBox="0 0 24 24"><path d="M12 2L15 8H9L12 2Z" /></svg>
    Miner
  </button>

  <button id="upgrade-btn">
    <svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zm7-18L5.33 9h13.34L12 2zM12 4.83 15.66 9H8.34L12 4.83z" /></svg>
    Améliorer (<span id="upgrade-cost">100</span>)
  </button>

  <div id="log"></div>

  <script>
    class AetherCore {
      constructor() {
        this.state = JSON.parse(localStorage.getItem("aether-core")) || {
          coins: 0,
          energy: 100,
          maxEnergy: 100,
          power: 1,
          multiplier: 1,
          missionClicks: 0,
          upgradeCost: 100
        };

        this.ui = {
          coins: document.getElementById("coins"),
          energy: document.getElementById("energy"),
          maxEnergy: document.getElementById("max-energy"),
          power: document.getElementById("power"),
          multiplier: document.getElementById("multiplier"),
          user: document.getElementById("telegram-user"),
          log: document.getElementById("log"),
          mineBtn: document.getElementById("mine-btn"),
          upgradeBtn: document.getElementById("upgrade-btn"),
          upgradeCost: document.getElementById("upgrade-cost")
        };

        this.init();
      }

      init() {
        this.loadTelegramUser();
        this.updateUI();
        this.ui.mineBtn.onclick = () => this.mine();
        this.ui.upgradeBtn.onclick = () => this.upgrade();
        setInterval(() => this.gameLoop(), 1000);
      }

      loadTelegramUser() {
        try {
          if (window.Telegram && Telegram.WebApp && Telegram.WebApp.initDataUnsafe) {
            const user = Telegram.WebApp.initDataUnsafe.user;
            if (user && user.first_name) {
              this.ui.user.textContent = "Connecté : " + user.first_name;
            }
          }
        } catch (e) {
          this.ui.user.textContent = "Connecté : Anonyme";
        }
      }

      updateUI() {
        const s = this.state;
        this.ui.coins.textContent = s.coins;
        this.ui.energy.textContent = s.energy;
        this.ui.maxEnergy.textContent = s.maxEnergy;
        this.ui.power.textContent = s.power;
        this.ui.multiplier.textContent = s.multiplier;
        this.ui.upgradeCost.textContent = s.upgradeCost;
      }

      mine() {
        if (this.state.energy <= 0) {
          this.log("Énergie insuffisante !");
          return;
        }

        const gain = this.state.power * this.state.multiplier;
        this.state.coins += gain;
        this.state.energy -= 1;
        this.state.missionClicks += 1;

        this.updateUI();
        this.save();
      }

      upgrade() {
        const cost = this.state.upgradeCost;
        if (this.state.coins < cost) {
          this.log("Pas assez de coins.");
          return;
        }

        this.state.coins -= cost;
        this.state.power += 1;
        this.state.upgradeCost = Math.floor(this.state.upgradeCost * 1.5);
        this.updateUI();
        this.save();
      }

      gameLoop() {
        if (this.state.energy < this.state.maxEnergy) {
          this.state.energy += 1;
          this.updateUI();
        }
      }

      save() {
        localStorage.setItem("aether-core", JSON.stringify(this.state));
      }

      log(msg) {
        this.ui.log.textContent = msg;
        setTimeout(() => {
          this.ui.log.textContent = "";
        }, 2000);
      }
    }

    document.addEventListener("DOMContentLoaded", () => new AetherCore());
  </script>
</body>
</html>